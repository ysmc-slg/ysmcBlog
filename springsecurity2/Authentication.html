<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="generator" content="VuePress 2.0.0-beta.27">
    <link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="icon" href="/favicon.ico"><link rel="manifest" href="/manifest.json"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.5.1/katex.min.css"><meta name="theme-color" content="#ffffff"><meta name="google-site-verification" content=""><title>认证 | 余生慢尝</title><meta name="description" content="认证">
    <link rel="modulepreload" href="/assets/app.a55bac48.js"><link rel="modulepreload" href="/assets/Authentication.html.83eeee82.js"><link rel="modulepreload" href="/assets/plugin-vue_export-helper.5a098b48.js"><link rel="modulepreload" href="/assets/Authentication.html.1554cbc5.js">
    <link rel="stylesheet" href="/assets/style.bde21de7.css">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme-container" data-v-3a25be96><!--[--><header class="navbar"><div class="toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a href="/" class=""><!----><span class="site-name can-hide">余生慢尝</span></a></span><div class="navbar-links-wrapper" style=""><!--[--><!--]--><nav class="navbar-links can-hide"><!--[--><div class="navbar-links-item"><a href="/" class="nav-link" aria-label="首页"><!--[--><!--]--> 首页 <!--[--><!--]--></a></div><div class="navbar-links-item"><a href="/preface/" class="nav-link" aria-label="前言"><!--[--><!--]--> 前言 <!--[--><!--]--></a></div><div class="navbar-links-item"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="数据库"><span class="title">数据库</span><span class="arrow down"></span></button><button class="mobile-dropdown-title" type="button" aria-label="数据库"><span class="title">数据库</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="nav-dropdown"><!--[--><li class="dropdown-item"><a href="/database/redis/" class="nav-link" aria-label="Redis"><!--[--><!--]--> Redis <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/database/mysql/" class="nav-link" aria-label="Mysql"><!--[--><!--]--> Mysql <!--[--><!--]--></a></li><!--]--></ul><!--]--></div></div><div class="navbar-links-item"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="java系"><span class="title">java系</span><span class="arrow down"></span></button><button class="mobile-dropdown-title" type="button" aria-label="java系"><span class="title">java系</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="nav-dropdown"><!--[--><li class="dropdown-item"><a href="/java/basics/" class="nav-link" aria-label="java基础"><!--[--><!--]--> java基础 <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/java/jdk8/" class="nav-link" aria-label="Java8新特性"><!--[--><!--]--> Java8新特性 <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/java/reflection/" class="nav-link" aria-label="java反射"><!--[--><!--]--> java反射 <!--[--><!--]--></a></li><!--]--></ul><!--]--></div></div><div class="navbar-links-item"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="MQ"><span class="title">MQ</span><span class="arrow down"></span></button><button class="mobile-dropdown-title" type="button" aria-label="MQ"><span class="title">MQ</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="nav-dropdown"><!--[--><li class="dropdown-item"><a href="/mq/rabbitmq/" class="nav-link" aria-label="rabbitMQ"><!--[--><!--]--> rabbitMQ <!--[--><!--]--></a></li><!--]--></ul><!--]--></div></div><div class="navbar-links-item"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="解决方案"><span class="title">解决方案</span><span class="arrow down"></span></button><button class="mobile-dropdown-title" type="button" aria-label="解决方案"><span class="title">解决方案</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="nav-dropdown"><!--[--><li class="dropdown-item"><a href="/solution/dyanmicDataSource/" class="nav-link" aria-label="自定义动态数据源"><!--[--><!--]--> 自定义动态数据源 <!--[--><!--]--></a></li><!--]--></ul><!--]--></div></div><div class="navbar-links-item"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="SSM"><span class="title">SSM</span><span class="arrow down"></span></button><button class="mobile-dropdown-title" type="button" aria-label="SSM"><span class="title">SSM</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="nav-dropdown"><!--[--><li class="dropdown-item"><a href="/ssm/spring/" class="nav-link" aria-label="Spring"><!--[--><!--]--> Spring <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/ssm/springmvc/" class="nav-link" aria-label="SpringMVC"><!--[--><!--]--> SpringMVC <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/ssm/mybatis/" class="nav-link" aria-label="Mybatis"><!--[--><!--]--> Mybatis <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/ssm/integration/" class="nav-link" aria-label="SSM整合"><!--[--><!--]--> SSM整合 <!--[--><!--]--></a></li><li class="dropdown-item"><!--[--><h4 class="dropdown-subtitle"><span>高级部分</span></h4><ul class="dropdown-subitem-wrapper"><!--[--><li class="dropdown-subitem"><a href="/ssm/ssm-senior/spring/" class="nav-link" aria-label="Spring"><!--[--><!--]--> Spring <!--[--><!--]--></a></li><li class="dropdown-subitem"><a href="/ssm/ssm-senior/springmvc/" class="nav-link" aria-label="SpringMVC"><!--[--><!--]--> SpringMVC <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><!--]--></ul><!--]--></div></div><div class="navbar-links-item"><a href="/springboot/" class="nav-link" aria-label="SpringBoot"><!--[--><!--]--> SpringBoot <!--[--><!--]--></a></div><div class="navbar-links-item"><a href="/springsecurity2/" class="nav-link router-link-active" aria-label="SpringSecirity"><!--[--><!--]--> SpringSecirity <!--[--><!--]--></a></div><div class="navbar-links-item"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="前端"><span class="title">前端</span><span class="arrow down"></span></button><button class="mobile-dropdown-title" type="button" aria-label="前端"><span class="title">前端</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="nav-dropdown"><!--[--><li class="dropdown-item"><a href="/Front-end/es6/" class="nav-link" aria-label="ES6新特性"><!--[--><!--]--> ES6新特性 <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/Front-end/vue/" class="nav-link" aria-label="VueJS"><!--[--><!--]--> VueJS <!--[--><!--]--></a></li><!--]--></ul><!--]--></div></div><div class="navbar-links-item"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="常用工具"><span class="title">常用工具</span><span class="arrow down"></span></button><button class="mobile-dropdown-title" type="button" aria-label="常用工具"><span class="title">常用工具</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="nav-dropdown"><!--[--><li class="dropdown-item"><a class="nav-link external" href="https://element.eleme.cn/#/zh-CN/component/table" rel="noopener noreferrer" target="_blank" aria-label="elementUI"><!--[--><!--]--> elementUI <span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span><!--[--><!--]--></a></li><li class="dropdown-item"><a class="nav-link external" href="https://cn.vuejs.org/v2/guide/" rel="noopener noreferrer" target="_blank" aria-label="Vue文档"><!--[--><!--]--> Vue文档 <span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span><!--[--><!--]--></a></li><li class="dropdown-item"><a class="nav-link external" href="http://momentjs.cn/docs/" rel="noopener noreferrer" target="_blank" aria-label="momentjs"><!--[--><!--]--> momentjs <span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span><!--[--><!--]--></a></li><li class="dropdown-item"><a class="nav-link external" href="http://easypoi.mydoc.io/" rel="noopener noreferrer" target="_blank" aria-label="EasyPoi文档"><!--[--><!--]--> EasyPoi文档 <span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span><!--[--><!--]--></a></li><!--]--></ul><!--]--></div></div><!--]--></nav><!--[--><!--[--><a class="icon-button" href="https://github.com/ysmc-slg/ysmcBlog" target="_blank" aria-label="View GitHub Repo" data-v-3a25be96><!----></a><!--]--><!--]--><button class="toggle-dark-button" title="toggle dark mode"><svg style="" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg style="display:none;" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><form class="search-box" role="search"><input type="search" placeholder="搜索" autocomplete="off" spellcheck="false" value><!----></form></div></header><!--]--><div class="sidebar-mask"></div><!--[--><aside class="sidebar"><nav class="navbar-links"><!--[--><div class="navbar-links-item"><a href="/" class="nav-link" aria-label="首页"><!--[--><!--]--> 首页 <!--[--><!--]--></a></div><div class="navbar-links-item"><a href="/preface/" class="nav-link" aria-label="前言"><!--[--><!--]--> 前言 <!--[--><!--]--></a></div><div class="navbar-links-item"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="数据库"><span class="title">数据库</span><span class="arrow down"></span></button><button class="mobile-dropdown-title" type="button" aria-label="数据库"><span class="title">数据库</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="nav-dropdown"><!--[--><li class="dropdown-item"><a href="/database/redis/" class="nav-link" aria-label="Redis"><!--[--><!--]--> Redis <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/database/mysql/" class="nav-link" aria-label="Mysql"><!--[--><!--]--> Mysql <!--[--><!--]--></a></li><!--]--></ul><!--]--></div></div><div class="navbar-links-item"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="java系"><span class="title">java系</span><span class="arrow down"></span></button><button class="mobile-dropdown-title" type="button" aria-label="java系"><span class="title">java系</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="nav-dropdown"><!--[--><li class="dropdown-item"><a href="/java/basics/" class="nav-link" aria-label="java基础"><!--[--><!--]--> java基础 <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/java/jdk8/" class="nav-link" aria-label="Java8新特性"><!--[--><!--]--> Java8新特性 <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/java/reflection/" class="nav-link" aria-label="java反射"><!--[--><!--]--> java反射 <!--[--><!--]--></a></li><!--]--></ul><!--]--></div></div><div class="navbar-links-item"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="MQ"><span class="title">MQ</span><span class="arrow down"></span></button><button class="mobile-dropdown-title" type="button" aria-label="MQ"><span class="title">MQ</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="nav-dropdown"><!--[--><li class="dropdown-item"><a href="/mq/rabbitmq/" class="nav-link" aria-label="rabbitMQ"><!--[--><!--]--> rabbitMQ <!--[--><!--]--></a></li><!--]--></ul><!--]--></div></div><div class="navbar-links-item"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="解决方案"><span class="title">解决方案</span><span class="arrow down"></span></button><button class="mobile-dropdown-title" type="button" aria-label="解决方案"><span class="title">解决方案</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="nav-dropdown"><!--[--><li class="dropdown-item"><a href="/solution/dyanmicDataSource/" class="nav-link" aria-label="自定义动态数据源"><!--[--><!--]--> 自定义动态数据源 <!--[--><!--]--></a></li><!--]--></ul><!--]--></div></div><div class="navbar-links-item"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="SSM"><span class="title">SSM</span><span class="arrow down"></span></button><button class="mobile-dropdown-title" type="button" aria-label="SSM"><span class="title">SSM</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="nav-dropdown"><!--[--><li class="dropdown-item"><a href="/ssm/spring/" class="nav-link" aria-label="Spring"><!--[--><!--]--> Spring <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/ssm/springmvc/" class="nav-link" aria-label="SpringMVC"><!--[--><!--]--> SpringMVC <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/ssm/mybatis/" class="nav-link" aria-label="Mybatis"><!--[--><!--]--> Mybatis <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/ssm/integration/" class="nav-link" aria-label="SSM整合"><!--[--><!--]--> SSM整合 <!--[--><!--]--></a></li><li class="dropdown-item"><!--[--><h4 class="dropdown-subtitle"><span>高级部分</span></h4><ul class="dropdown-subitem-wrapper"><!--[--><li class="dropdown-subitem"><a href="/ssm/ssm-senior/spring/" class="nav-link" aria-label="Spring"><!--[--><!--]--> Spring <!--[--><!--]--></a></li><li class="dropdown-subitem"><a href="/ssm/ssm-senior/springmvc/" class="nav-link" aria-label="SpringMVC"><!--[--><!--]--> SpringMVC <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><!--]--></ul><!--]--></div></div><div class="navbar-links-item"><a href="/springboot/" class="nav-link" aria-label="SpringBoot"><!--[--><!--]--> SpringBoot <!--[--><!--]--></a></div><div class="navbar-links-item"><a href="/springsecurity2/" class="nav-link router-link-active" aria-label="SpringSecirity"><!--[--><!--]--> SpringSecirity <!--[--><!--]--></a></div><div class="navbar-links-item"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="前端"><span class="title">前端</span><span class="arrow down"></span></button><button class="mobile-dropdown-title" type="button" aria-label="前端"><span class="title">前端</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="nav-dropdown"><!--[--><li class="dropdown-item"><a href="/Front-end/es6/" class="nav-link" aria-label="ES6新特性"><!--[--><!--]--> ES6新特性 <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/Front-end/vue/" class="nav-link" aria-label="VueJS"><!--[--><!--]--> VueJS <!--[--><!--]--></a></li><!--]--></ul><!--]--></div></div><div class="navbar-links-item"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="常用工具"><span class="title">常用工具</span><span class="arrow down"></span></button><button class="mobile-dropdown-title" type="button" aria-label="常用工具"><span class="title">常用工具</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="nav-dropdown"><!--[--><li class="dropdown-item"><a class="nav-link external" href="https://element.eleme.cn/#/zh-CN/component/table" rel="noopener noreferrer" target="_blank" aria-label="elementUI"><!--[--><!--]--> elementUI <span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span><!--[--><!--]--></a></li><li class="dropdown-item"><a class="nav-link external" href="https://cn.vuejs.org/v2/guide/" rel="noopener noreferrer" target="_blank" aria-label="Vue文档"><!--[--><!--]--> Vue文档 <span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span><!--[--><!--]--></a></li><li class="dropdown-item"><a class="nav-link external" href="http://momentjs.cn/docs/" rel="noopener noreferrer" target="_blank" aria-label="momentjs"><!--[--><!--]--> momentjs <span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span><!--[--><!--]--></a></li><li class="dropdown-item"><a class="nav-link external" href="http://easypoi.mydoc.io/" rel="noopener noreferrer" target="_blank" aria-label="EasyPoi文档"><!--[--><!--]--> EasyPoi文档 <span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span><!--[--><!--]--></a></li><!--]--></ul><!--]--></div></div><!--]--></nav><!--[--><!--]--><ul class="sidebar-links"><!--[--><!--[--><p class="sidebar-heading sidebar-item active">springsecurity2</p><ul class=""><li><!--[--><a href="/springsecurity2/" class="nav-link router-link-active sidebar-item" aria-label="初识SpringSecurity"><!--[--><!--]--> 初识SpringSecurity <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/springsecurity2/Authentication.html" class="router-link-active router-link-exact-active nav-link router-link-active sidebar-item active" aria-label="认证"><!--[--><!--]--> 认证 <!--[--><!--]--></a><ul class="sidebar-sub-items"><li><!--[--><a aria-current="page" href="/springsecurity2/Authentication.html#spring-security-基本认证" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="Spring Security 基本认证"><!--[--><!--]--> Spring Security 基本认证 <!--[--><!--]--></a><ul class="sidebar-sub-items"><li><!--[--><a aria-current="page" href="/springsecurity2/Authentication.html#快速入门" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="快速入门"><!--[--><!--]--> 快速入门 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/springsecurity2/Authentication.html#流程分析" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="流程分析"><!--[--><!--]--> 流程分析 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/springsecurity2/Authentication.html#原理分析" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="原理分析"><!--[--><!--]--> 原理分析 <!--[--><!--]--></a><!----><!--]--></li></ul><!--]--></li></ul><!--]--></li></ul><!--]--><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="page" data-v-3a25be96><!--[--><!--]--><div class="theme-default-content"><!--[--><h1 id="认证" tabindex="-1"><a class="header-anchor" href="#认证" aria-hidden="true">#</a> 认证</h1><p>在 Spring Security 中，对认证功能做了大量的封装，以至于开发者只需要稍微配置一下就能使用认证功能，然而要深刻理解其源码并非易事，本文带领我们从最基本的用法开始讲解，最终再扩展到对源码的理解。</p><h2 id="spring-security-基本认证" tabindex="-1"><a class="header-anchor" href="#spring-security-基本认证" aria-hidden="true">#</a> Spring Security 基本认证</h2><h3 id="快速入门" tabindex="-1"><a class="header-anchor" href="#快速入门" aria-hidden="true">#</a> 快速入门</h3><p>在 Spring Boot 项目中使用 Spring Security 非常方便，创建一个新的 Spring Boot 项目，只需要引入 Web 和 Spring Security 依赖即可：</p><div class="language-xml ext-xml"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-security<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-web<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>然后在项目中提供一个用于测试的 <code>/hello</code> 接口，代码如下：</p><div class="language-java ext-java"><pre class="language-java"><code><span class="token annotation punctuation">@RestController</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">HelloController</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/hello&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">hello</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span><span class="token string">&quot;hello&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>接下来启动项目，<code>/hello</code> 接口就已经被保护起来了。当用户访问 <code>/hello</code> 接口时，会自动跳转到登录页面，如图 2-1 所示，用户登录成功后，才能访问到 <code>/hello</code> 接口。</p><p>默认的登录用户名是 <code>user</code>，登录密码则是一个随机生成的 UUID 字符串，在项目启动日志中可以看到登录密码（这也意味着项目每次启动时，密码都会发生变化）：</p><div class="language-properties ext-properties"><pre class="language-properties"><code><span class="token attr-name">Using</span> <span class="token attr-value">generated security password: 8ef9c800-17cf-47a3-9984-8ff936db6dd8</span>
</code></pre></div><p>输入默认的用户名和密码，就可以成功登录了。这就是 Spring Security 的强大之处，只需要引入一个依赖，所有的接口就会被自动保护起来。</p><h3 id="流程分析" tabindex="-1"><a class="header-anchor" href="#流程分析" aria-hidden="true">#</a> 流程分析</h3><p>通过一个简单那的流程图来看一下上面案例中的请求流程，如图 2-2 所示。</p><p><img src="/blogImg/springsecurity/请求流程图.jpg" alt="请求流程图"></p><p>流程图比较清晰地说明了整个请求过程：</p><ol><li>浏览器发起请求去访问 <code>/hello</code> 接口，这个接口默认是需要认证之后才能访问的。</li><li>这个请求会走一遍 Spring Security 中的过滤器链，在最后的 <code>FilterSecurityInterceptor</code> 过滤器中被拦截下来，因为系统发现用户未认证。请求拦截下来之后，接下来抛出 <code>AccessDeniedException</code> 异常。</li><li>抛出 <code>AccessDeniedException</code> 异常在 <code>ExceptionTranslationFilter</code> 过滤器中被捕获，<code>ExceptionTranslationFilter</code> 过滤器通过调用 <code>LoginUrlAuthenticationEntryPoint#commence</code> 方法给客户端返回 302，要求客户端重定向到 <code>/login</code> 页面。</li><li>客户端发送 <code>/login</code> 请求</li><li><code>/login</code> 请求被 <code>DefaultLonginPageGeneratingFilter</code> 过滤器拦截下来，并在该过滤器中返回登录页面。所以当用户访问 <code>/hello</code> 接口时会首先看到登录页面。</li></ol><p>在整个过程中，相当于客户端一共发送了两个请求，第一个请求是 <code>/hello</code>，服务端收到之后，返回302，要求客户重定向到 <code>login</code>，于是客户端又发送了 <code>/login</code> 请求。</p><p><strong>注意</strong>：</p><p>上面的流程分析是对添加完 Spring Security 依赖，什么都没设置，系统默认进行的流程。我们其实可以进行一些自定义配置，如：</p><p>前后端分离项目中，在用户未认证的情况下，不会跳转到 <code>/login</code> 页面，而是返回 <code>用户未认证</code>，至于前端怎样处理就不是我们管的了。处理这个问题一般会创建一个类实现 <code>AuthenticationEntryPoint</code> 接口，在类中实现认证失败的操作，当认证失败后就会进入自定义的类中。所以上面的 4、5 就不会执行了。</p><p>还有，登录页面也是可以配置的，下面的文章会专门展开讲解</p><h3 id="原理分析" tabindex="-1"><a class="header-anchor" href="#原理分析" aria-hidden="true">#</a> 原理分析</h3><p>在 <a aria-current="page" href="/springsecurity2/Authentication.html#%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8" class="router-link-active router-link-exact-active">快速入门</a> 中，虽然只是引入了一个依赖，代码不多，但是 Spring Boot 背后却默默做了很多事情：</p><ul><li>开启 Spring Security 自动化配置，开启后，会自动创建一个名为 springSecurityFilterChain 的过滤器，幵注入到 Spring 容器中，这个过滤器将负责所有的安全管理，包括用户的认证、授权、重定向到登录页面等（springSecurityFilterChain 实际上代理了 Spring Security 中的过滤器链）</li><li>创建一个 UserDetailsService 实例，UserDetailsService 负责提供用户数据，默认的用户数据是基于内存的用户，用户名为 user，密码则是随机生成的 UUID 字符串。</li><li>给用户生成一个默认的登录页面。</li><li>开启 CSRF 攻击防御。</li><li>开启会话固定攻击防御。</li><li>集成 X-XSS-Protection。</li><li>集成 X-Frame-Options 以防止单击劫持。</li></ul><p>这里涉及的细节还是非常多的，登录的细节我们会在后面的章节继续详细介绍，这里主要分析一下默认用户的生成以及默认登录页面的生成。</p><h4 id="默认用户生成" tabindex="-1"><a class="header-anchor" href="#默认用户生成" aria-hidden="true">#</a> 默认用户生成</h4><p>Spring Security 中定义了 UserDetails 接口来规范开发者自定义的用户对象，这样方便一些旧系统、用户表已经固定的系统集成到 Spring Security 认证体系中。</p><p>UserDetails 接口定义如下：</p><div class="language-java ext-java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">UserDetails</span> <span class="token keyword">extends</span> <span class="token class-name">Serializable</span> <span class="token punctuation">{</span>
  <span class="token class-name">Collection</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">GrantedAuthority</span><span class="token punctuation">&gt;</span></span> <span class="token function">getAuthorities</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token class-name">String</span> <span class="token function">getPassword</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token class-name">String</span> <span class="token function">getUsername</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">boolean</span> <span class="token function">isAccountNonExpired</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">boolean</span> <span class="token function">isAccountNonLocked</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">boolean</span> <span class="token function">isCredentialsNonExpired</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">boolean</span> <span class="token function">isEnabled</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>该接口中一共定义了 7 个方法：</p><ol><li>getAuthorities 方法：返回当前账户所具备的权限。</li><li>getPassword 方法：返回当前账户的密码。</li><li>getUsername 方法：返回当前账户的用户名。</li><li>isAccountNonExpired 方法：返回当前账户是否未过期。</li><li>isAccountNonLocked 方法：返回当前账户是否未锁定。</li><li>isCredentialsNonExpired 方法：返回当前账户凭证（如密码）是否未过期。</li><li>isEnabled 方法：返回当前账户是否可用。</li></ol><p>这是用户对象的定义，而负责提供用户数据源的接口 是 UserDetailsService ，UserDetailsService 中只有一个查询用户的方法，代码如下：</p><div class="language-java ext-java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">UserDetailsService</span> <span class="token punctuation">{</span>
 <span class="token class-name">UserDetails</span> <span class="token function">loadUserByUsername</span><span class="token punctuation">(</span><span class="token class-name">String</span> username<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">UsernameNotFoundException</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>loadUserByUsername 有一个参数是 username，这是用户在认证时传入的用户名，最常见的就是用户在登录表单中输入的用户名（实际开发时还可能存在其他情况，例如使用 CAS 单点登录时，username 并非表单输入的用户名，而是 CAS Server 认证成功后回调的用户名参数），开发者在这里拿到用户名之后，再去数据库中查询用户，最终返回一个 UserDetails 实例。在实际项目中，一般需要开发者自定义 UserDetailsService 的实现。如果开发者没有自定义 UserDetailsService 的实现，Spring Security 也为 UserDetailsService 提供了默认实现，如图 2-3 所示。</p><p><img src="/blogImg/springsecurity/UserDetailsService的默认实现类.jpg" alt="UserDetailsService的默认实现类"></p><ul><li>UserDetailsManager 在 UserDetailsService 的基础上，继续定义了添加用户、更新用户、 删除用户、修改密码以及判断用户是否存在共 5 种方法。</li><li>JdbcDaoImpl 在 UserDetailsService 的基础上，通过 spring-jdbc 实现了从数据库中查询用户的方法。</li><li>InMemoryUserDetailsManager 实现了 UserDetailsManager 中关于用户的增删改查方法，不过都是基于内存的操作，数据幵没有持久化。</li><li>JdbcUserDetailsManager 继承自 JdbcDaoImpl 同时又实现了 UserDetailsManager 接口，因 此可以通过 JdbcUserDetailsManager 实现对用户的增删改查操作，这些操作都会持久化到数据库中。不过 JdbcUserDetailsManager 有一个局限性，就是操作数据库中用户的 SQL 都是提前写好的，不够灵活，因此在实际开发中 JdbcUserDetailsManager 使用幵不多。</li><li>CachingUserDetailsService 的特点是会将 UserDetailsService 缓存起来。</li><li>UserDetailsServiceDelegator 则是提供了 UserDetailsService 的懒加载功能。</li><li>ReactiveUserDetailsServiceAdapter 是 webflux-web-security 模块定义的 UserDetailsService 实现</li></ul><p>当我们使用 Spring Security 时，如果仅仅只是引入一个 Spring Security 依赖，则默认使用的用户就是由 InMemoryUserDetailsManager 提供的。</p><p>大家知道，Spring Boot 之所以能够做到零配置使用 Spring Security，就是因为它提供了众多的自动化配置类。其中，针对 UserDetailsService 的自动化配置类是 UserDetailsServiceAutoConfiguration，这个类的源码并不长，我们一起来看一下：</p><div class="language-java ext-java"><pre class="language-java"><code><span class="token annotation punctuation">@Configuration</span><span class="token punctuation">(</span>
    proxyBeanMethods <span class="token operator">=</span> <span class="token boolean">false</span>
<span class="token punctuation">)</span>
<span class="token annotation punctuation">@ConditionalOnClass</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token class-name">AuthenticationManager</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@ConditionalOnBean</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token class-name">ObjectPostProcessor</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@ConditionalOnMissingBean</span><span class="token punctuation">(</span>
    value <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token class-name">AuthenticationManager</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token class-name">AuthenticationProvider</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token class-name">UserDetailsService</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    type <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">&quot;org.springframework.security.oauth2.jwt.JwtDecoder&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;org.springframework.security.oauth2.server.resource.introspection.OpaqueTokenIntrospector&quot;</span><span class="token punctuation">}</span>
<span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserDetailsServiceAutoConfiguration</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> NOOP_PASSWORD_PREFIX <span class="token operator">=</span> <span class="token string">&quot;{noop}&quot;</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">Pattern</span> PASSWORD_ALGORITHM_PATTERN <span class="token operator">=</span> <span class="token class-name">Pattern</span><span class="token punctuation">.</span><span class="token function">compile</span><span class="token punctuation">(</span><span class="token string">&quot;^\\{.+}.*<!--vuepress-ssr-app-->quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">Log</span> logger <span class="token operator">=</span> <span class="token class-name">LogFactory</span><span class="token punctuation">.</span><span class="token function">getLog</span><span class="token punctuation">(</span><span class="token class-name">UserDetailsServiceAutoConfiguration</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">UserDetailsServiceAutoConfiguration</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Bean</span>
    <span class="token annotation punctuation">@ConditionalOnMissingBean</span><span class="token punctuation">(</span>
        type <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">&quot;org.springframework.security.oauth2.client.registration.ClientRegistrationRepository&quot;</span><span class="token punctuation">}</span>
    <span class="token punctuation">)</span>
    <span class="token annotation punctuation">@Lazy</span>
    <span class="token keyword">public</span> <span class="token class-name">InMemoryUserDetailsManager</span> <span class="token function">inMemoryUserDetailsManager</span><span class="token punctuation">(</span><span class="token class-name">SecurityProperties</span> properties<span class="token punctuation">,</span> <span class="token class-name">ObjectProvider</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">PasswordEncoder</span><span class="token punctuation">&gt;</span></span> passwordEncoder<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">User</span> user <span class="token operator">=</span> properties<span class="token punctuation">.</span><span class="token function">getUser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> roles <span class="token operator">=</span> user<span class="token punctuation">.</span><span class="token function">getRoles</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">InMemoryUserDetailsManager</span><span class="token punctuation">(</span>
				<span class="token class-name">User</span><span class="token punctuation">.</span><span class="token function">withUsername</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">password</span><span class="token punctuation">(</span><span class="token function">getOrDeducePassword</span><span class="token punctuation">(</span>user<span class="token punctuation">,</span> passwordEncoder<span class="token punctuation">.</span><span class="token function">getIfAvailable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
						<span class="token punctuation">.</span><span class="token function">roles</span><span class="token punctuation">(</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">toStringArray</span><span class="token punctuation">(</span>roles<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token class-name">String</span> <span class="token function">getOrDeducePassword</span><span class="token punctuation">(</span><span class="token class-name">User</span> user<span class="token punctuation">,</span> <span class="token class-name">PasswordEncoder</span> encoder<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">String</span> password <span class="token operator">=</span> user<span class="token punctuation">.</span><span class="token function">getPassword</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>user<span class="token punctuation">.</span><span class="token function">isPasswordGenerated</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            logger<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">&quot;%n%nUsing generated security password: %s%n&quot;</span><span class="token punctuation">,</span> user<span class="token punctuation">.</span><span class="token function">getPassword</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">return</span> encoder <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>PASSWORD_ALGORITHM_PATTERN<span class="token punctuation">.</span><span class="token function">matcher</span><span class="token punctuation">(</span>password<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">matches</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token string">&quot;{noop}&quot;</span> <span class="token operator">+</span> password <span class="token operator">:</span> password<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>从上述代码中可以看到，有两个比较重要的条件促使系统自动提供一个 InMemoryUserDetailsManager 的实例：</p><ol><li>当前 classpath 下存在 AuthenticationManager 类。</li><li>当前项目中，系统没有提供 AuthenticationManager、AuthenticationProvider、UserDetailsService 以及 ClientRegistrationRepository 实例。</li></ol><p>默认情况下，上面的条件都会满足，此时 Spring Security 会提供一个 InMemoryUserDetailsManager 实例。从 inMemoryUserDetailsManager 方法中可以看到，用户数据源自 <code>SecurityProperties#getUser</code> 方法：</p><div class="language-java ext-java"><pre class="language-java"><code><span class="token annotation punctuation">@ConfigurationProperties</span><span class="token punctuation">(</span>prefix <span class="token operator">=</span> <span class="token string">&quot;spring.security&quot;</span><span class="token punctuation">)</span>
  <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SecurityProperties</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token class-name">User</span> user <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token class-name">User</span> <span class="token function">getUser</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>user<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">User</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> name <span class="token operator">=</span> <span class="token string">&quot;user&quot;</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> password <span class="token operator">=</span> UUID<span class="token punctuation">.</span><span class="token function">randomUUID</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> roles <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//省略 getter/setter</span>
  <span class="token punctuation">}</span> 
 <span class="token punctuation">}</span>
</code></pre></div><p>从 SecurityProperties.User 类中，我们就可以看到默认的用户名是 user，默认的密码是一个 UUID 字符串。再回到 inMemoryUserDetailsManager 方法中，构造 InMemoryUserDetailsManager 实例时 需要一 个 User 对 象 。 这 里 的 User 对 象 不 是 SecurityProperties.User ， 而 是 org.springframework.security.core.userdetails.User，这是 Spring Security 提供的一个实现了 UserDetails 接口的用户类，该类提供了相应的静态方法，用来构造一个默认的 User 实例。同时，默认的用户密码还在 getOrDeducePassword 方法中进行了二次处理，由于默认的 encoder 为 null，所以密码的二次处理只是给密码加了一个前缀{noop}，表示密码是明文存储的。</p><p>经过以上的源码梳理，相信大家已经明白了 Spring Security 默认的用户名/密码是来自哪里了！另外，当看了 SecurityProperties 的源码后，只要对 Spring Boot 中 properties 属性的加载机制有一点了解，就会明白，只要我们在项目的 application.properties 配置文件中添加如下配置，就能定制 SecurityProperties.User 类中各属性的值：</p><div class="language-propertie ext-propertie"><pre class="language-propertie"><code>spring.security.user.name=javaboy
spring.security.user.password=123
spring.security.user.roles=admin,user
</code></pre></div><p>配置完成后，重启项目，此时登录的用户名就是 javaboy，登录密码就是 123 ，登录成功 后用户具备 admin 和 user 两个角色。</p><h4 id="默认页面生成" tabindex="-1"><a class="header-anchor" href="#默认页面生成" aria-hidden="true">#</a> 默认页面生成</h4><p><a aria-current="page" href="/springsecurity2/Authentication.html#%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8" class="router-link-active router-link-exact-active">快速入门</a> 小节的案例中，一共存在两个默认页面，一个就是图 2-1 所示的登录页面，另外一个则是注销登录页面。当用户登录成功之后，在浏览器中输入 http://localhost:8080/logout 就 可以看到注销登录页面，如图 2-4 所示。</p><p><img src="/blogImg/springsecurity/注销登录页面.jpg" alt="注销登录页面"></p><p>那么这两个页面是从哪里来的呢？这里剖析一下。在 [上篇文章](./README.html#web 安全) 中，我们介绍了 Spring Security 中常见的过滤器，在这些常见的过滤器中就包含两个和页面相关的过滤器：DefaultLoginPageGeneratingFilter 和 DefaultLogoutPageGeneratingFilter。</p><p>通过过滤器的名字就可以分辨出 DefaultLoginPageGeneratingFilter 过滤器用来生成默认的登录页面，DefaultLogoutPageGeneratingFilter 过滤器则用来生成默认的注销页面。</p><p>先来看 DefaultLoginPageGeneratingFilter。作为 Spring Security 过滤器链中的一员，在第一次请求/hello 接口的时候，就会经过 DefaultLoginPageGeneratingFilter 过滤器，但是由于/hello 接口和登录无关，因此 DefaultLoginPageGeneratingFilter 过滤器并未干涉/hello 接口。等到第二次重定向到/login 页面的时候，这个时候就和 DefaultLoginPageGeneratingFilter 有关系了，此时请求就会在 DefaultLoginPageGeneratingFilter 中进行处理，生成登录页面返回给客户端。</p><p>我们来看一下 DefaultLoginPageGeneratingFilter 的源码，源码比较长，这里仅列出核心部分：</p><div class="language-java ext-java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DefaultLoginPageGeneratingFilter</span> <span class="token keyword">extends</span> <span class="token class-name">GenericFilterBean</span> <span class="token punctuation">{</span>
  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">doFilter</span><span class="token punctuation">(</span><span class="token class-name">ServletRequest</span> req<span class="token punctuation">,</span> <span class="token class-name">ServletResponse</span> res<span class="token punctuation">,</span> <span class="token class-name">FilterChain</span> chain<span class="token punctuation">)</span>
			<span class="token keyword">throws</span> <span class="token class-name">IOException</span><span class="token punctuation">,</span> <span class="token class-name">ServletException</span> <span class="token punctuation">{</span>
		<span class="token class-name">HttpServletRequest</span> request <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span><span class="token punctuation">)</span> req<span class="token punctuation">;</span>
		<span class="token class-name">HttpServletResponse</span> response <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">HttpServletResponse</span><span class="token punctuation">)</span> res<span class="token punctuation">;</span>

		<span class="token keyword">boolean</span> loginError <span class="token operator">=</span> <span class="token function">isErrorPage</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">boolean</span> logoutSuccess <span class="token operator">=</span> <span class="token function">isLogoutSuccess</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isLoginUrlRequest</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span> <span class="token operator">||</span> loginError <span class="token operator">||</span> logoutSuccess<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token class-name">String</span> loginPageHtml <span class="token operator">=</span> <span class="token function">generateLoginPageHtml</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> loginError<span class="token punctuation">,</span>
					logoutSuccess<span class="token punctuation">)</span><span class="token punctuation">;</span>
			response<span class="token punctuation">.</span><span class="token function">setContentType</span><span class="token punctuation">(</span><span class="token string">&quot;text/html;charset=UTF-8&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			response<span class="token punctuation">.</span><span class="token function">setContentLength</span><span class="token punctuation">(</span>loginPageHtml<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token class-name">StandardCharsets</span><span class="token punctuation">.</span>UTF_8<span class="token punctuation">)</span><span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span>
			response<span class="token punctuation">.</span><span class="token function">getWriter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>loginPageHtml<span class="token punctuation">)</span><span class="token punctuation">;</span>

			<span class="token keyword">return</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		chain<span class="token punctuation">.</span><span class="token function">doFilter</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> response<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

  <span class="token comment">// 生成页面</span>
  <span class="token keyword">private</span> <span class="token class-name">String</span> <span class="token function">generateLoginPageHtml</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">,</span> <span class="token keyword">boolean</span> loginError<span class="token punctuation">,</span>
			<span class="token keyword">boolean</span> logoutSuccess<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token class-name">String</span> errorMsg <span class="token operator">=</span> <span class="token string">&quot;Invalid credentials&quot;</span><span class="token punctuation">;</span>

		<span class="token keyword">if</span> <span class="token punctuation">(</span>loginError<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token class-name">HttpSession</span> session <span class="token operator">=</span> request<span class="token punctuation">.</span><span class="token function">getSession</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

			<span class="token keyword">if</span> <span class="token punctuation">(</span>session <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
				<span class="token class-name">AuthenticationException</span> ex <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">AuthenticationException</span><span class="token punctuation">)</span> session
						<span class="token punctuation">.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span><span class="token class-name">WebAttributes</span><span class="token punctuation">.</span>AUTHENTICATION_EXCEPTION<span class="token punctuation">)</span><span class="token punctuation">;</span>
				errorMsg <span class="token operator">=</span> ex <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">?</span> ex<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token string">&quot;Invalid credentials&quot;</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>

		<span class="token class-name">StringBuilder</span> sb <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StringBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

		sb<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">&quot;&lt;!DOCTYPE html&gt;\n&quot;</span>
				<span class="token operator">+</span> <span class="token string">&quot;&lt;html lang=\&quot;en\&quot;&gt;\n&quot;</span>
				<span class="token operator">+</span> <span class="token string">&quot;  &lt;head&gt;\n&quot;</span>
				<span class="token operator">+</span> <span class="token string">&quot;    &lt;meta charset=\&quot;utf-8\&quot;&gt;\n&quot;</span>
				<span class="token operator">+</span> <span class="token string">&quot;    &lt;meta name=\&quot;viewport\&quot; content=\&quot;width=device-width, initial-scale=1, shrink-to-fit=no\&quot;&gt;\n&quot;</span>
				<span class="token operator">+</span> <span class="token string">&quot;    &lt;meta name=\&quot;description\&quot; content=\&quot;\&quot;&gt;\n&quot;</span>
				<span class="token operator">+</span> <span class="token string">&quot;    &lt;meta name=\&quot;author\&quot; content=\&quot;\&quot;&gt;\n&quot;</span>
				<span class="token operator">+</span> <span class="token string">&quot;    &lt;title&gt;Please sign in&lt;/title&gt;\n&quot;</span>
				<span class="token operator">+</span> <span class="token string">&quot;    &lt;link href=\&quot;https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta/css/bootstrap.min.css\&quot; rel=\&quot;stylesheet\&quot; integrity=\&quot;sha384-/Y6pD6FV/Vv2HJnA6t+vslU6fwYXjCFtcEpHbNJ0lyAFsXTsjBbfaDjzALeQsN6M\&quot; crossorigin=\&quot;anonymous\&quot;&gt;\n&quot;</span>
				<span class="token operator">+</span> <span class="token string">&quot;    &lt;link href=\&quot;https://getbootstrap.com/docs/4.0/examples/signin/signin.css\&quot; rel=\&quot;stylesheet\&quot; crossorigin=\&quot;anonymous\&quot;/&gt;\n&quot;</span>
				<span class="token operator">+</span> <span class="token string">&quot;  &lt;/head&gt;\n&quot;</span>
				<span class="token operator">+</span> <span class="token string">&quot;  &lt;body&gt;\n&quot;</span>
				<span class="token operator">+</span> <span class="token string">&quot;     &lt;div class=\&quot;container\&quot;&gt;\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

		<span class="token class-name">String</span> contextPath <span class="token operator">=</span> request<span class="token punctuation">.</span><span class="token function">getContextPath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>formLoginEnabled<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			sb<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">&quot;      &lt;form class=\&quot;form-signin\&quot; method=\&quot;post\&quot; action=\&quot;&quot;</span> <span class="token operator">+</span> contextPath <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>authenticationUrl <span class="token operator">+</span> <span class="token string">&quot;\&quot;&gt;\n&quot;</span>
					<span class="token operator">+</span> <span class="token string">&quot;        &lt;h2 class=\&quot;form-signin-heading\&quot;&gt;Please sign in&lt;/h2&gt;\n&quot;</span>
					<span class="token operator">+</span> <span class="token function">createError</span><span class="token punctuation">(</span>loginError<span class="token punctuation">,</span> errorMsg<span class="token punctuation">)</span>
					<span class="token operator">+</span> <span class="token function">createLogoutSuccess</span><span class="token punctuation">(</span>logoutSuccess<span class="token punctuation">)</span>
					<span class="token operator">+</span> <span class="token string">&quot;        &lt;p&gt;\n&quot;</span>
					<span class="token operator">+</span> <span class="token string">&quot;          &lt;label for=\&quot;username\&quot; class=\&quot;sr-only\&quot;&gt;Username&lt;/label&gt;\n&quot;</span>
					<span class="token operator">+</span> <span class="token string">&quot;          &lt;input type=\&quot;text\&quot; id=\&quot;username\&quot; name=\&quot;&quot;</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>usernameParameter <span class="token operator">+</span> <span class="token string">&quot;\&quot; class=\&quot;form-control\&quot; placeholder=\&quot;Username\&quot; required autofocus&gt;\n&quot;</span>
					<span class="token operator">+</span> <span class="token string">&quot;        &lt;/p&gt;\n&quot;</span>
					<span class="token operator">+</span> <span class="token string">&quot;        &lt;p&gt;\n&quot;</span>
					<span class="token operator">+</span> <span class="token string">&quot;          &lt;label for=\&quot;password\&quot; class=\&quot;sr-only\&quot;&gt;Password&lt;/label&gt;\n&quot;</span>
					<span class="token operator">+</span> <span class="token string">&quot;          &lt;input type=\&quot;password\&quot; id=\&quot;password\&quot; name=\&quot;&quot;</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>passwordParameter <span class="token operator">+</span> <span class="token string">&quot;\&quot; class=\&quot;form-control\&quot; placeholder=\&quot;Password\&quot; required&gt;\n&quot;</span>
					<span class="token operator">+</span> <span class="token string">&quot;        &lt;/p&gt;\n&quot;</span>
					<span class="token operator">+</span> <span class="token function">createRememberMe</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>rememberMeParameter<span class="token punctuation">)</span>
					<span class="token operator">+</span> <span class="token function">renderHiddenInputs</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span>
					<span class="token operator">+</span> <span class="token string">&quot;        &lt;button class=\&quot;btn btn-lg btn-primary btn-block\&quot; type=\&quot;submit\&quot;&gt;Sign in&lt;/button&gt;\n&quot;</span>
					<span class="token operator">+</span> <span class="token string">&quot;      &lt;/form&gt;\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		<span class="token keyword">if</span> <span class="token punctuation">(</span>openIdEnabled<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			sb<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">&quot;      &lt;form name=\&quot;oidf\&quot; class=\&quot;form-signin\&quot; method=\&quot;post\&quot; action=\&quot;&quot;</span> <span class="token operator">+</span> contextPath <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>openIDauthenticationUrl <span class="token operator">+</span> <span class="token string">&quot;\&quot;&gt;\n&quot;</span>
					<span class="token operator">+</span> <span class="token string">&quot;        &lt;h2 class=\&quot;form-signin-heading\&quot;&gt;Login with OpenID Identity&lt;/h2&gt;\n&quot;</span>
					<span class="token operator">+</span> <span class="token function">createError</span><span class="token punctuation">(</span>loginError<span class="token punctuation">,</span> errorMsg<span class="token punctuation">)</span>
					<span class="token operator">+</span> <span class="token function">createLogoutSuccess</span><span class="token punctuation">(</span>logoutSuccess<span class="token punctuation">)</span>
					<span class="token operator">+</span> <span class="token string">&quot;        &lt;p&gt;\n&quot;</span>
					<span class="token operator">+</span> <span class="token string">&quot;          &lt;label for=\&quot;username\&quot; class=\&quot;sr-only\&quot;&gt;Identity&lt;/label&gt;\n&quot;</span>
					<span class="token operator">+</span> <span class="token string">&quot;          &lt;input type=\&quot;text\&quot; id=\&quot;username\&quot; name=\&quot;&quot;</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>openIDusernameParameter <span class="token operator">+</span> <span class="token string">&quot;\&quot; class=\&quot;form-control\&quot; placeholder=\&quot;Username\&quot; required autofocus&gt;\n&quot;</span>
					<span class="token operator">+</span> <span class="token string">&quot;        &lt;/p&gt;\n&quot;</span>
					<span class="token operator">+</span> <span class="token function">createRememberMe</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>openIDrememberMeParameter<span class="token punctuation">)</span>
					<span class="token operator">+</span> <span class="token function">renderHiddenInputs</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span>
					<span class="token operator">+</span> <span class="token string">&quot;        &lt;button class=\&quot;btn btn-lg btn-primary btn-block\&quot; type=\&quot;submit\&quot;&gt;Sign in&lt;/button&gt;\n&quot;</span>
					<span class="token operator">+</span> <span class="token string">&quot;      &lt;/form&gt;\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		<span class="token keyword">if</span> <span class="token punctuation">(</span>oauth2LoginEnabled<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			sb<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">&quot;&lt;h2 class=\&quot;form-signin-heading\&quot;&gt;Login with OAuth 2.0&lt;/h2&gt;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			sb<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token function">createError</span><span class="token punctuation">(</span>loginError<span class="token punctuation">,</span> errorMsg<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			sb<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token function">createLogoutSuccess</span><span class="token punctuation">(</span>logoutSuccess<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			sb<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">&quot;&lt;table class=\&quot;table table-striped\&quot;&gt;\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Map<span class="token punctuation">.</span>Entry</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> clientAuthenticationUrlToClientName <span class="token operator">:</span> oauth2AuthenticationUrlToClientName<span class="token punctuation">.</span><span class="token function">entrySet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
				sb<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">&quot; &lt;tr&gt;&lt;td&gt;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token class-name">String</span> url <span class="token operator">=</span> clientAuthenticationUrlToClientName<span class="token punctuation">.</span><span class="token function">getKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				sb<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">&quot;&lt;a href=\&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>contextPath<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">&quot;\&quot;&gt;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token class-name">String</span> clientName <span class="token operator">=</span> <span class="token class-name">HtmlUtils</span><span class="token punctuation">.</span><span class="token function">htmlEscape</span><span class="token punctuation">(</span>clientAuthenticationUrlToClientName<span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				sb<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>clientName<span class="token punctuation">)</span><span class="token punctuation">;</span>
				sb<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">&quot;&lt;/a&gt;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				sb<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">&quot;&lt;/td&gt;&lt;/tr&gt;\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
			sb<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">&quot;&lt;/table&gt;\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>saml2LoginEnabled<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			sb<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">&quot;&lt;h2 class=\&quot;form-signin-heading\&quot;&gt;Login with SAML 2.0&lt;/h2&gt;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			sb<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token function">createError</span><span class="token punctuation">(</span>loginError<span class="token punctuation">,</span> errorMsg<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			sb<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token function">createLogoutSuccess</span><span class="token punctuation">(</span>logoutSuccess<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			sb<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">&quot;&lt;table class=\&quot;table table-striped\&quot;&gt;\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Map<span class="token punctuation">.</span>Entry</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> relyingPartyUrlToName <span class="token operator">:</span> saml2AuthenticationUrlToProviderName<span class="token punctuation">.</span><span class="token function">entrySet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
				sb<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">&quot; &lt;tr&gt;&lt;td&gt;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token class-name">String</span> url <span class="token operator">=</span> relyingPartyUrlToName<span class="token punctuation">.</span><span class="token function">getKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				sb<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">&quot;&lt;a href=\&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>contextPath<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">&quot;\&quot;&gt;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token class-name">String</span> partyName <span class="token operator">=</span> <span class="token class-name">HtmlUtils</span><span class="token punctuation">.</span><span class="token function">htmlEscape</span><span class="token punctuation">(</span>relyingPartyUrlToName<span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				sb<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>partyName<span class="token punctuation">)</span><span class="token punctuation">;</span>
				sb<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">&quot;&lt;/a&gt;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				sb<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">&quot;&lt;/td&gt;&lt;/tr&gt;\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
			sb<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">&quot;&lt;/table&gt;\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		sb<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">&quot;&lt;/div&gt;\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		sb<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">&quot;&lt;/body&gt;&lt;/html&gt;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

		<span class="token keyword">return</span> sb<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre></div><p>DefaultLoginPageGeneratingFilter 的源码执行流程还是非常清晰的，我们梳理一下：</p><ol><li>在 doFilter 方法中，首先判断出当前请求是否为登录出错请求、注销成功请求或者登录请求。如果是这三种请求中的任意一个，就会在 DefaultLoginPageGeneratingFilter 过滤器中生成登录页面并返回，否则请求继续往下走，执行下一个过滤器（这就是一开始的/hello 请求为什么没有被 DefaultLoginPageGeneratingFilter 拦截下来的原因）。</li><li>如果当前请求是登录出错请求、注销成功请求或者登录请求中的任意一个，就会调用 generateLoginPageHtml 方法去生成登录页面。在该方法中，如果有异常信息就把异常信息取出来一同返回给前端，然后根据不同的登录场景，生成不同的登录页面。生成过程其实就是字符串拼接，拼接出不同的登录表单（由于源码太长，上面没有贴出来具体的字符串拼接源码，读者可以自行查看 DefaultLoginPageGeneratingFilter 类的源码）。</li><li>登录页面生成后，接下来通过 HttpServletResponse 将登录页面写回到前端，然后调用 return 方法跳出过滤器链。这就是 DefaultLoginPageGeneratingFilter 的工作过程。这里重点搞明白为什么/hello 请求没有被拦截，而/login 请求却被拦截了，其他都很好懂。</li></ol><p>理解了 DefaultLoginPageGeneratingFilter，再来看 DefaultLogoutPageGeneratingFilter 就更容易了，DefaultLogoutPageGeneratingFilter 部分核心源码如下：</p><div class="language-java ext-java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DefaultLogoutPageGeneratingFilter</span> <span class="token keyword">extends</span> <span class="token class-name">OncePerRequestFilter</span> <span class="token punctuation">{</span>
  <span class="token keyword">private</span> <span class="token class-name">RequestMatcher</span> matcher <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AntPathRequestMatcher</span><span class="token punctuation">(</span><span class="token string">&quot;/logout&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;GET&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token annotation punctuation">@Override</span>
  <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">doFilterInternal</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">,</span><span class="token class-name">HttpServletResponse</span> response<span class="token punctuation">,</span> <span class="token class-name">FilterChain</span> filterChain<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ServletException</span><span class="token punctuation">,</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>matcher<span class="token punctuation">.</span><span class="token function">matches</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">renderLogout</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> response<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      filterChain<span class="token punctuation">.</span><span class="token function">doFilter</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> response<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>


  <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">renderLogout</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> response<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
    <span class="token class-name">String</span> page <span class="token operator">=</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span>
    response<span class="token punctuation">.</span><span class="token function">setContentType</span><span class="token punctuation">(</span><span class="token string">&quot;text/html;charset=UTF-8&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    response<span class="token punctuation">.</span><span class="token function">getWriter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>page<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> 
<span class="token punctuation">}</span>
</code></pre></div><p>从上述源码中可以看出，请求到来之后，会先判断是否是注销请求 <code>/logout</code>，如果是 <code>/logout</code> 请求，则渲染一个注销请求的页面返回给客户端，渲染过程和前面登录页面的渲染过程类似，也是字符串拼接（这里省略了字符串拼接，读者可以参考 DefaultLogoutPageGeneratingFilter 的源码）；否则请求继续往下走，执行下一个过滤器。</p><p>通过前面的分析，相信大家对这个简单的案例已经有所了解，看似只是加了一个依赖，但实际上 Spring Security 和 Spring Boot 在背后都默默做了很多事情，当然还有很多没有介绍到的，我们将在后面的章节中和大家一起继续深究。</p><!--]--></div><footer class="page-meta"><div class="meta-item edit-link"><a class="nav-link external meta-item-label" href="https://github.com/ysmc-slg/ysmcBlog/edit/master/docs/springsecurity2/Authentication.md" rel="noopener noreferrer" target="_blank" aria-label="编辑文档！"><!--[--><!--]--> 编辑文档！ <span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span><!--[--><!--]--></a></div><div class="meta-item last-updated"><span class="meta-item-label">上次更新: </span><span class="meta-item-info">2022/6/22 14:25:35</span></div><div class="meta-item contributors"><span class="meta-item-label">贡献者: </span><span class="meta-item-info"><!--[--><!--[--><span class="contributor" title="email: 494786209@qq.com">ysmc</span><!----><!--]--><!--]--></span></div></footer><nav class="page-nav"><p class="inner"><span class="prev"> ← <a href="/springsecurity2/" class="nav-link router-link-active" aria-label="初识SpringSecurity"><!--[--><!--]--> 初识SpringSecurity <!--[--><!--]--></a></span><!----></p></nav><!--[--><!--]--></main><!--]--></div><!----><!----><!--]--></div>
    <script type="module" src="/assets/app.a55bac48.js" defer></script>
  </body>
</html>
