---
description: 工作流介绍
---

# 工作流介绍

## 三大工作流

最早的工作流是 jBPM，可以目前市面上大部分工作流的共同祖先。

* Activiti：当 jBPM 发展到 jBPM4 这个版本的时候，内部发生了分歧，然后一波人出来单干，基于 jBPM4 开发出来了 Activiti5；留下来的人，继续开发 jBPM5 的时候，几乎完全重写了 jBPM4 的代码。目前 Activiti 的设计侧重于云，即更靠拢 Spring Cloud、Docker、K8s 等。
* Flowable：Activiti5 在发展了一段时间之后，又从中分离出来一个团队，开发出来了 Flowable。Flowable 目前的核心思路还是做一个功能非常非常完善的流程引擎工具。除了常用的最最基本的工作流之外，Flowable 还提供了很多扩展点。
* Camunda：Activiti5 发展没多久，从 Activiti5 中分离中的团队，开发的 Camunda。在这三个主流的流程引擎中，Camunda 是最为轻量级的一个，如果我们的系统，当用户在使用的过程中，需要动态的绘制流程图，那么可以使用 Camunda，这是一个小巧的工具，可以非常的方便的嵌入到我们自己的系统中。Camunda 还提供了一个 bpmn.js 的工具，可以非常方便的实现流程图的绘制。

## 流程图

工作流执行的基础是流程图，一个完整的流程，先得画出来一个完整的流程图。

流程图的绘制有一套统一的标准 BPMN（Business Process Model And Notation），中文译作业务流程模型和标记法。

BPMN 就是一套图形化表示法，用图形来绘制、梳理业务流程模型。就是说，BPMN 其实是一套非常古老的流程图规范，Activiti、Flowable 以及 Camunda 都是支持这个规范的。所以，无论使用哪一个流程图，都可以依照 BPMN 规范去绘制流程图。

## BPMN 流程图绘制规范

![image-20221214170830340](https://img.zxqs.top/image-20221214170830340.png)

从上图中，大致可以归类出流程分为：

* 事件
* 连线
* 任务
* 网关

### 事件

开始事件/结束事件等等。

![image-20221214171012546](https://img.zxqs.top/image-20221214171012546.png)

这是我们上面用到的事件，实际上，还有很多其他类型的事件。



### 连线

![img](https://cdn.nlark.com/yuque/0/2022/png/21447419/1661693820071-5c41b3c8-a40d-4f58-91a1-2d8e4ed16720.png)


连接各个不同元素之间的线条，就是连线。

注意，线条之上，可能会有条件。例如，在互斥网关上，满足一定的条件，流程图就继续往下走，不满足条件，流程图就回到之前的某一个位置上。

### 任务

在上面的流程图中，所有的矩形，都是任务，但是任务还有很多细分。

- 用户任务

需要人工参与完成的工作建模。

![img](https://cdn.nlark.com/yuque/0/2022/png/21447419/1661694083605-1e032e26-05cb-4b07-ac78-2d6bb343ac44.png)


- 服务任务

机器自动完成的事情，例如用户请假，经理审批通过，审批通过之后，想通过企业微信给用户发送一个通知，告诉他请假通过。这样的任务，可以使用服务任务，当流程走到这一步的时候，自动调用某一个 Java Bean，或者某一个远程服务去完成通知的发送，这是自动完成的，不需要人工介入。

![img](https://cdn.nlark.com/yuque/0/2022/png/21447419/1661694096311-aa7dd948-8780-4f04-bcdb-8e6ee95a4302.png)

- 活动

活动可以算是一种特殊的任务。活动之中，往往可以在活动中，调用另外一个流程使之作为当前流程的子流程去执行。活动一般又可以继续细分为用户活动、脚本活动等等。。。

![img](https://cdn.nlark.com/yuque/0/2022/png/21447419/1661694114789-db322dc5-9c20-48c9-a178-9fca50de527c.png)

- 接收任务

这个接收任务中，其实并不需要做什么额外的事情，流程到这一步就自动停下来，需要人工去助力一把，去推动流程继续向下走。

![img](https://cdn.nlark.com/yuque/0/2022/png/21447419/1661694520700-9b050488-1407-47db-9236-8e4612f03d9d.png)

- 发送任务

将消息发送给外部的参与者。

![img](https://cdn.nlark.com/yuque/0/2022/png/21447419/1661694537709-42996c53-3145-4760-81f1-e6cfa0faaf47.png)

- 脚本任务

一个自动化的活动，当流程执行到脚本任务的时候，自动执行相应的脚本。

![img](https://cdn.nlark.com/yuque/0/2022/png/21447419/1661694577149-5a9be956-cea8-42de-84a7-fd2dcfc25cf5.png)

- 业务规则任务

BPMN2.0 中引入的用来对接业务规则的引擎，业务规则主要用于同步执行一个或者多个规则。

![img](https://cdn.nlark.com/yuque/0/2022/png/21447419/1661694599589-0e0b4dff-6b4b-4ace-bda9-b11a3820f6ae.png)

虽然这里分类比较多，但是实际上，任务主要就两种：

1. 用户任务：需要用户介入的任务。
2. 服务任务：机器自动完成的任务。发送任务、接收任务、脚本任务等等，这些其实都是服务任务的细分而已。

### 网关

- 互斥网关

这个可以有多个入口，但是只有一个有效的出口。

![img](https://cdn.nlark.com/yuque/0/2022/png/21447419/1661695023194-4d1052b0-79ec-41f7-ba84-26ae6841addf.png)

- 并行网关

并行网关一般是成对出现的，当有并行操作的时候，可以使用并行网关。

![img](https://cdn.nlark.com/yuque/0/2022/png/21447419/1661695035159-62058140-3f2f-4c8c-8f01-f52a97f4832a.png)

- 相容网关

这种网关可能会存在多个有效的出口。

![img](https://cdn.nlark.com/yuque/0/2022/png/21447419/1661695182944-bc227d0b-2536-44d0-85f3-f8b7a56319ef.png)

- 事件网关

通过中间事件驱动的网关，当等待的事件触发之后，才会触发决策。

![img](https://cdn.nlark.com/yuque/0/2022/png/21447419/1661695231183-1847676d-424b-4866-8dd8-733634a80fa4.png)

