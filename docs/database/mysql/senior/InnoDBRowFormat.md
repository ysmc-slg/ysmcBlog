---
title: InnoDB 行格式
autoPrev: engines
---

MySQL 服务器上负责对表中数据的读取和写入工作的部分是 存储引擎 ，而服务器又支持不同类型的存储引擎，比如 InnoDB 、 MyISAM 、 Memory 啥的，不同的存储引擎一般是由不同的人为实现不同的特性而开发的，`真实数据在不同存储引擎中存放的格式一般是不同的`，甚至有的存储引擎比如 Memory 都不用磁盘来存储数据，也就是说关闭服务器后表中的数据就消失了。由于 InnoDB 是 MySQL 默认的存储引擎，也是我们最常用到的存储引擎，我们也没有那么多时间去把各个存储引擎的内部实现都看一遍，所以本集要唠叨的是使用 InnoDB 作为存储引擎的数据存储结构。

## 数据页简介

InnoDB 是一个将表中的数据存储到磁盘上的存储引擎，所以即使关机后重启我们的数据还是存在的。而真正处理数据的过程是发生在内存中的，所以需要把磁盘中的数据加载到内存中，如果是处理写入或修改请求的话，还需要把内存中的内容刷新到磁盘上。而我们知道读写磁盘的速度非常慢，和内存读写差了几个数量级，所以当我们想从表中获取某些记录时， InnoDB 存储引擎需要一条一条的把记录从磁盘上读出来么？不，那样会慢死。

InnoDB 采取的方式是：`将数据划分为若干个页，以页作为磁盘和内存之间交互的基本单位，InnoDB中页的大小一般为 16 KB`。也就是在一般情况下，一次最少从磁盘中读取16KB的内容到内存中，一次最少把内存中的16KB内容刷新到磁盘中。

## InnoDB行格式

我们平时是以`记录`为单位来向表中插入数据的，这些记录在磁盘上的存放方式也被称为 `行格式` 或者 `记录格式` 。设计 `InnoDB` 存储引擎有4种不同类型的 `行格式` ，分别是 `Compact` 、 `Redundant` 、`Dynamic` 和 `Compressed` 行格式，随着时间的推移，他们可能会设计出更多的行格式，但是不管怎么变，在原理上大体都是相同的。

### 指定行格式的语法

我们可以在创建或修改表的语句中指定 `行格式` ：

```sql
create table 表明 (列的信息) row_format = 行格式名称;

alter table 表明 row_format = 行格式
```

通过一下语句查看行格式

```sql
-- 查看默认行格式 mysql8 默认是Dynamic
SELECT @@innodb_default_row_format;

-- 使用如下语法查看具体表使用的行格式
SHOW TABLE STATUS like '表名';
```

比如我们在数据库里创建一个演示用的表 `record_format_demo` ，可以这样指定它的 行格式 ：

```sql
CREATE TABLE record_format_demo (
c1 VARCHAR(10),
c2 VARCHAR(10) NOT NULL,
c3 CHAR(10),
c4 VARCHAR(10)
) CHARSET=ascii ROW_FORMAT=COMPACT;
```

可以看到我们刚刚创建的这个表的 行格式 就是 `Compact`。

我们现在向这个表中插入两条记录：

```sql
INSERT INTO record_format_demo(c1, c2, c3, c4) VALUES('aaaa', 'bbb', 'cc', 'd'),('eeee', 'fff', NULL, NULL);
```

![image-20221121163830304](https://img.zxqs.top/20221121163831.png)

演示表的内容也填充好了，现在我们就来看看各个行格式下的存储方式到底有啥不同吧～

### Compact 行格式

![image-20221121165726262](https://img.zxqs.top/20221121165727.png)

一条完整的记录其实可以被分为 `记录的额外信息` 和 `记录的真实数据` 两大部分，下边我们详细看一下这两部分的组成。