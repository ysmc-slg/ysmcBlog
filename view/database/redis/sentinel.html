<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Redis哨兵模式(Sentinel) | 余生慢尝</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" href="/favicon.ico">
    <link name="author" content="余生慢尝">
    <link name="keywords" content="余生慢尝">
    <link rel="manifest" href="/manifest.json">
    <link rel="apple-touch-icon" href="/icons/apple-touch-icon-152x152.png">
    <link rel="mask-icon" href="/icons/safari-pinned-tab.svg" color="#3eaf7c">
    <meta name="description" content="余生慢尝的笔记">
    <meta name="theme-color" content="#3eaf7c">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="msapplication-TileImage" content="/icons/msapplication-icon-144x144.png">
    <meta name="msapplication-TileColor" content="#000000">
    
    <link rel="preload" href="/assets/css/0.styles.b42adf48.css" as="style"><link rel="preload" href="/assets/js/app.6cd24fb3.js" as="script"><link rel="preload" href="/assets/js/2.3a807b85.js" as="script"><link rel="preload" href="/assets/js/32.7d05b40e.js" as="script"><link rel="preload" href="/assets/js/3.dcc3d320.js" as="script"><link rel="prefetch" href="/assets/js/10.d0995cad.js"><link rel="prefetch" href="/assets/js/11.c341184e.js"><link rel="prefetch" href="/assets/js/12.3ad3ed48.js"><link rel="prefetch" href="/assets/js/13.69637e18.js"><link rel="prefetch" href="/assets/js/14.51399e31.js"><link rel="prefetch" href="/assets/js/15.dc053f1e.js"><link rel="prefetch" href="/assets/js/16.3cdf495d.js"><link rel="prefetch" href="/assets/js/17.2e879e03.js"><link rel="prefetch" href="/assets/js/18.ad396c6f.js"><link rel="prefetch" href="/assets/js/19.0132fb82.js"><link rel="prefetch" href="/assets/js/20.171bbcb7.js"><link rel="prefetch" href="/assets/js/21.c3ba5cd5.js"><link rel="prefetch" href="/assets/js/22.6d786ea0.js"><link rel="prefetch" href="/assets/js/23.e2635fd6.js"><link rel="prefetch" href="/assets/js/24.c30cb4fc.js"><link rel="prefetch" href="/assets/js/25.b42ddd79.js"><link rel="prefetch" href="/assets/js/26.d7850a4c.js"><link rel="prefetch" href="/assets/js/27.7a597bd9.js"><link rel="prefetch" href="/assets/js/28.377e78ac.js"><link rel="prefetch" href="/assets/js/29.6b5c99e8.js"><link rel="prefetch" href="/assets/js/30.f00013d1.js"><link rel="prefetch" href="/assets/js/31.b19ac70c.js"><link rel="prefetch" href="/assets/js/33.f11152ab.js"><link rel="prefetch" href="/assets/js/34.5eed254d.js"><link rel="prefetch" href="/assets/js/35.25f0ecad.js"><link rel="prefetch" href="/assets/js/36.234f5149.js"><link rel="prefetch" href="/assets/js/37.8f883bec.js"><link rel="prefetch" href="/assets/js/38.68a7daa9.js"><link rel="prefetch" href="/assets/js/39.5bb1a634.js"><link rel="prefetch" href="/assets/js/4.6206e85e.js"><link rel="prefetch" href="/assets/js/40.3bc5385f.js"><link rel="prefetch" href="/assets/js/41.720ac7f6.js"><link rel="prefetch" href="/assets/js/42.fbcce83b.js"><link rel="prefetch" href="/assets/js/43.d984d0d7.js"><link rel="prefetch" href="/assets/js/44.df2c943e.js"><link rel="prefetch" href="/assets/js/45.4e9cb8f5.js"><link rel="prefetch" href="/assets/js/46.4a8a61bc.js"><link rel="prefetch" href="/assets/js/47.221d1b82.js"><link rel="prefetch" href="/assets/js/48.9adcf4c1.js"><link rel="prefetch" href="/assets/js/49.e9bd312b.js"><link rel="prefetch" href="/assets/js/5.851d534f.js"><link rel="prefetch" href="/assets/js/50.925234e9.js"><link rel="prefetch" href="/assets/js/51.16bd53ba.js"><link rel="prefetch" href="/assets/js/52.0b7475ed.js"><link rel="prefetch" href="/assets/js/53.3113821e.js"><link rel="prefetch" href="/assets/js/54.0963f1e4.js"><link rel="prefetch" href="/assets/js/55.ce57ee47.js"><link rel="prefetch" href="/assets/js/56.b09083f3.js"><link rel="prefetch" href="/assets/js/57.4d4b01f5.js"><link rel="prefetch" href="/assets/js/58.7cb73879.js"><link rel="prefetch" href="/assets/js/59.c0f56755.js"><link rel="prefetch" href="/assets/js/6.0a2e90c4.js"><link rel="prefetch" href="/assets/js/60.44d20444.js"><link rel="prefetch" href="/assets/js/61.907e8330.js"><link rel="prefetch" href="/assets/js/62.9288c2ca.js"><link rel="prefetch" href="/assets/js/63.6432a66c.js"><link rel="prefetch" href="/assets/js/64.fa441d03.js"><link rel="prefetch" href="/assets/js/65.fa57688a.js"><link rel="prefetch" href="/assets/js/66.dd4e5c17.js"><link rel="prefetch" href="/assets/js/67.22fe1a0e.js"><link rel="prefetch" href="/assets/js/68.f4a22282.js"><link rel="prefetch" href="/assets/js/69.45e2df96.js"><link rel="prefetch" href="/assets/js/7.1cc9bea6.js"><link rel="prefetch" href="/assets/js/70.ee6afc61.js"><link rel="prefetch" href="/assets/js/71.2c0ff11e.js"><link rel="prefetch" href="/assets/js/8.2247b01d.js"><link rel="prefetch" href="/assets/js/9.d3ebcdcf.js">
    <link rel="stylesheet" href="/assets/css/0.styles.b42adf48.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/assets/img/hero.png" alt="余生慢尝" class="logo"> <span class="site-name can-hide">余生慢尝</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="/view/preface/" class="nav-link">
  前言
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="数据库" class="dropdown-title"><span class="title">数据库</span> <span class="arrow down"></span></button> <button type="button" aria-label="数据库" class="mobile-dropdown-title"><span class="title">数据库</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/view/database/redis/" class="nav-link router-link-active">
  Redis
</a></li><li class="dropdown-item"><!----> <a href="/view/database/mysql/" class="nav-link">
  Mysql
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="java系" class="dropdown-title"><span class="title">java系</span> <span class="arrow down"></span></button> <button type="button" aria-label="java系" class="mobile-dropdown-title"><span class="title">java系</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/view/java/basics/" class="nav-link">
  java基础
</a></li><li class="dropdown-item"><!----> <a href="/view/java/jdk8/" class="nav-link">
  Java8新特性
</a></li><li class="dropdown-item"><!----> <a href="/view/java/reflection/" class="nav-link">
  java反射
</a></li><li class="dropdown-item"><h4>
          MQ
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/view/mq/rabbitmq/" class="nav-link">
  rabbitMQ
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="SSM" class="dropdown-title"><span class="title">SSM</span> <span class="arrow down"></span></button> <button type="button" aria-label="SSM" class="mobile-dropdown-title"><span class="title">SSM</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/view/ssm/spring/" class="nav-link">
  Spring
</a></li><li class="dropdown-item"><!----> <a href="/view/ssm/springmvc/" class="nav-link">
  SpringMVC
</a></li><li class="dropdown-item"><!----> <a href="/view/ssm/mybatis/" class="nav-link">
  Mybatis
</a></li></ul></div></div><div class="nav-item"><a href="/view/springboot/" class="nav-link">
  SpringBoot
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="常用工具" class="dropdown-title"><span class="title">常用工具</span> <span class="arrow down"></span></button> <button type="button" aria-label="常用工具" class="mobile-dropdown-title"><span class="title">常用工具</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://element.eleme.cn/#/zh-CN/component/table" target="_blank" rel="noopener noreferrer" class="nav-link external">
  elementUI
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://cn.vuejs.org/v2/guide/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Vue文档
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="http://momentjs.cn/docs/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  momentjs
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="http://easypoi.mydoc.io/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  EasyPoi文档
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="/view/preface/" class="nav-link">
  前言
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="数据库" class="dropdown-title"><span class="title">数据库</span> <span class="arrow down"></span></button> <button type="button" aria-label="数据库" class="mobile-dropdown-title"><span class="title">数据库</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/view/database/redis/" class="nav-link router-link-active">
  Redis
</a></li><li class="dropdown-item"><!----> <a href="/view/database/mysql/" class="nav-link">
  Mysql
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="java系" class="dropdown-title"><span class="title">java系</span> <span class="arrow down"></span></button> <button type="button" aria-label="java系" class="mobile-dropdown-title"><span class="title">java系</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/view/java/basics/" class="nav-link">
  java基础
</a></li><li class="dropdown-item"><!----> <a href="/view/java/jdk8/" class="nav-link">
  Java8新特性
</a></li><li class="dropdown-item"><!----> <a href="/view/java/reflection/" class="nav-link">
  java反射
</a></li><li class="dropdown-item"><h4>
          MQ
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/view/mq/rabbitmq/" class="nav-link">
  rabbitMQ
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="SSM" class="dropdown-title"><span class="title">SSM</span> <span class="arrow down"></span></button> <button type="button" aria-label="SSM" class="mobile-dropdown-title"><span class="title">SSM</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/view/ssm/spring/" class="nav-link">
  Spring
</a></li><li class="dropdown-item"><!----> <a href="/view/ssm/springmvc/" class="nav-link">
  SpringMVC
</a></li><li class="dropdown-item"><!----> <a href="/view/ssm/mybatis/" class="nav-link">
  Mybatis
</a></li></ul></div></div><div class="nav-item"><a href="/view/springboot/" class="nav-link">
  SpringBoot
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="常用工具" class="dropdown-title"><span class="title">常用工具</span> <span class="arrow down"></span></button> <button type="button" aria-label="常用工具" class="mobile-dropdown-title"><span class="title">常用工具</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://element.eleme.cn/#/zh-CN/component/table" target="_blank" rel="noopener noreferrer" class="nav-link external">
  elementUI
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://cn.vuejs.org/v2/guide/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Vue文档
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="http://momentjs.cn/docs/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  momentjs
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="http://easypoi.mydoc.io/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  EasyPoi文档
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Redis</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/view/database/redis/" aria-current="page" class="sidebar-link">前言</a></li><li><a href="/view/database/redis/install.html" class="sidebar-link">redis6安装</a></li><li><a href="/view/database/redis/key.html" class="sidebar-link">redis键(key)常用命令</a></li><li><a href="/view/database/redis/string.html" class="sidebar-link">string（字符串）</a></li><li><a href="/view/database/redis/list.html" class="sidebar-link">list(列表)</a></li><li><a href="/view/database/redis/set.html" class="sidebar-link">Set</a></li><li><a href="/view/database/redis/hash.html" class="sidebar-link">Hash</a></li><li><a href="/view/database/redis/zset.html" class="sidebar-link">Zset</a></li><li><a href="/view/database/redis/configuration.html" class="sidebar-link">配置文件介绍</a></li><li><a href="/view/database/redis/rdb.html" class="sidebar-link">Redis持久化之-RDB</a></li><li><a href="/view/database/redis/aof.html" class="sidebar-link">Redis持久化之-AOF</a></li><li><a href="/view/database/redis/masterSlave.html" class="sidebar-link">Redis主从复制</a></li><li><a href="/view/database/redis/sentinel.html" aria-current="page" class="active sidebar-link">Redis哨兵模式(Sentinel)</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/view/database/redis/sentinel.html#简介" class="sidebar-link">简介</a></li><li class="sidebar-sub-header"><a href="/view/database/redis/sentinel.html#sentinel的作用" class="sidebar-link">Sentinel的作用</a></li><li class="sidebar-sub-header"><a href="/view/database/redis/sentinel.html#sentinel的工作方式" class="sidebar-link">Sentinel的工作方式</a></li><li class="sidebar-sub-header"><a href="/view/database/redis/sentinel.html#sentinel-conf" class="sidebar-link">sentinel.conf</a></li><li class="sidebar-sub-header"><a href="/view/database/redis/sentinel.html#使用哨兵模式" class="sidebar-link">使用哨兵模式</a></li><li class="sidebar-sub-header"><a href="/view/database/redis/sentinel.html#主观下线" class="sidebar-link">主观下线</a></li><li class="sidebar-sub-header"><a href="/view/database/redis/sentinel.html#客观下线" class="sidebar-link">客观下线</a></li><li class="sidebar-sub-header"><a href="/view/database/redis/sentinel.html#配置传播" class="sidebar-link">配置传播</a></li><li class="sidebar-sub-header"><a href="/view/database/redis/sentinel.html#sentinel的-仲裁会" class="sidebar-link">sentinel的“仲裁会”</a></li><li class="sidebar-sub-header"><a href="/view/database/redis/sentinel.html#slave选举与优先级" class="sidebar-link">Slave选举与优先级</a></li></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h2 id="简介"><a href="#简介" class="header-anchor">#</a> 简介</h2> <p>Sentinel(哨兵)是用于<code>监控redis集群中Master状态</code>的工具，是Redis 的高可用性解决方案，sentinel哨兵模式已经被集成在redis2.4之后的版本中。sentinel是redis高可用的解决方案，<code>sentinel系统可以监视一个或者多个redis master服务，以及这些master服务的所有从服务；当某个master服务下线时，自动将该master下的某个从服务升级为master服务替代已下线的master服务继续处理请求。</code></p> <p>sentinel可以让redis实现主从复制，当一个集群中的master失效之后，sentinel可以选举出一个新的master用于自动接替master的工作，集群中的其他redis服务器自动指向新的master同步数据。一般建议sentinel采取奇数台，防止某一台sentinel无法连接到master导致误切换。其结构如下:</p> <p><img src="/blogImg/redis/20210617132409.png" alt="sentinel"></p> <p><strong>Redis-Sentinel是Redis官方推荐的高可用性(HA)解决方案</strong>，当用Redis做Master-slave的高可用方案时，假如master宕机了，Redis本身(包括它的很多客户端)都没有实现自动进行主备切换，而Redis-sentinel本身也是一个独立运行的进程，它能监控多个master-slave集群，发现master宕机后能进行自动切换。Sentinel由一个或多个Sentinel 实例 组成的Sentinel 系统可以监视任意多个主服务器，以及这些主服务器属下的所有从服务器，并在被监视的主服务器进入下线状态时，自动将下线主服务器属下的某个从服务器升级为新的主服务器。</p> <p>例如下图所示：</p> <p><img src="/blogImg/redis/20210617132746.png" alt="sentinel2"></p> <p>在Server1 掉线后：</p> <p><img src="/blogImg/redis/20210617133013.png" alt="sentinel2"></p> <p>升级Server2 为新的主服务器：</p> <p><img src="/blogImg/redis/20210617133044.png" alt="sentinel3"></p> <h2 id="sentinel的作用"><a href="#sentinel的作用" class="header-anchor">#</a> Sentinel的作用</h2> <ul><li>通过发送命令，让Redis服务器返回监控其运行状态，包括主服务器和从服务器。</li> <li>当哨兵监测到master宕机，会自动将slave切换成master，然后通过<code>发布订阅模式</code>通知其他的从服务器，修改配置文件，让它们切换主机。</li></ul> <h2 id="sentinel的工作方式"><a href="#sentinel的工作方式" class="header-anchor">#</a> Sentinel的工作方式</h2> <ol><li>每个Sentinel以<code>每10秒钟一次</code>的频率向它所知的Master，Slave以及其他 Sentinel 实例发送一个PING命令。</li> <li>如果一个实例（instance）距离最后一次有效回复PING命令的时间超过 down-after-milliseconds 选项所指定的值，则这个实例会被Sentinel标记为<code>主观下线</code>。</li> <li>如果一个Master被标记为主观下线，则正在监视这个Master的所有 Sentinel 要以每秒一次的频率确认Master的确进入了主观下线状态。</li> <li>当有足够数量的Sentinel（大于等于配置文件指定的值）在指定的时间范围内确认Master的确进入了主观下线状态，则Master会被标记为<code>客观下线</code>。</li> <li>在一般情况下，每个Sentinel 会以每10秒一次的频率向它已知的所有Master，Slave发送 INFO 命令。</li> <li>当Master被Sentinel标记为客观下线时，Sentinel 向下线的 Master 的所有Slave发送 INFO命令的频率会从10秒一次改为每秒一次。</li> <li>若没有足够数量的Sentinel同意Master已经下线，Master的客观下线状态就会被移除。 若 Master重新向Sentinel 的PING命令返回有效回复，Master的主观下线状态就会被移除。</li></ol> <h2 id="sentinel-conf"><a href="#sentinel-conf" class="header-anchor">#</a> sentinel.conf</h2> <ol><li><p><code>sentinel monitor &lt;masterName&gt; &lt;ip&gt; &lt;port&gt; &lt;quorum&gt;</code></p> <ul><li>masterName：对某个master+slave组合的一个区分标识（一套sentinel是可以监听多套master+slave这样的组合的）</li> <li>ip 和 port 就是master节点的 ip 和 端口号。</li> <li>quorum：<code>客观下线的一个依据</code>，意思是至少有 quorum 个sentinel标记这个master为<code>主观下线</code>，才会对这个master进行下线以及故障转移。quorum的值一般设置为sentinel个数的二分之一加1，例如3个sentinel就设置2。</li></ul></li> <li><p><code>sentinel down-after-milliseconds &lt;masterName&gt; &lt;timeout&gt;</code></p></li></ol> <p>这个配置其实就是进行<code>主观下线的一个依据</code>，masterName和上面的一样，timeout是一个毫秒值，表示：如果这台sentinel超过timeout这个时间都无法连通master包括slave（slave不需要客观下线，因为不需要故障转移）的话，就会主观认为该master已经下线（实际下线需要客观下线的判断通过才会下线）</p> <h2 id="使用哨兵模式"><a href="#使用哨兵模式" class="header-anchor">#</a> 使用哨兵模式</h2> <p>首先创建一个<code>sentinel.conf</code>文件，文件名一定不能错。同时添加以下配置</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code>sentinel monitor <span class="token generics"><span class="token punctuation">&lt;</span>masterName<span class="token punctuation">&gt;</span></span> <span class="token generics"><span class="token punctuation">&lt;</span>ip<span class="token punctuation">&gt;</span></span> <span class="token generics"><span class="token punctuation">&lt;</span>port<span class="token punctuation">&gt;</span></span> <span class="token generics"><span class="token punctuation">&lt;</span>quorum<span class="token punctuation">&gt;</span></span>
sentinel auth<span class="token operator">-</span>pass <span class="token generics"><span class="token punctuation">&lt;</span>masterName<span class="token punctuation">&gt;</span></span> <span class="token generics"><span class="token punctuation">&lt;</span>password<span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>如果你的redis没有设置密码，第二条配置不写</p> <p><img src="/blogImg/redis/20210617152207.png" alt="sentinel3"></p> <p>然后使用 <code>redis-sentinel /sentinel.conf</code> ，启动哨兵模式</p> <p><img src="/blogImg/redis/20210617152307.png" alt="sentinel3"></p> <p>此时哨兵就已经启动了，如果master挂了，会自动切换从服务为master</p> <p><img src="/blogImg/redis/20210617160013.png" alt="sentinel3"></p> <p>可以看到6381代替了6379，成为了master，如果6379重新启动只能当做slave</p> <p><img src="/blogImg/redis/20210617160331.png" alt="sentinel3"></p> <h2 id="主观下线"><a href="#主观下线" class="header-anchor">#</a> 主观下线</h2> <p>sentinel会向所有与其建立了命令连接的实例（master，slave，其他sentinel）发ping命令，如果在<code>down-after-milliseconds</code>给定的毫秒数之内，没有回复， 或者返回一个错误， 那么 Sentinel 将这个服务器标记为主观下线（sdown）。</p> <h2 id="客观下线"><a href="#客观下线" class="header-anchor">#</a> 客观下线</h2> <p>客观下线（odown）指的是多个 Sentinel 实例在对同一个<code>master</code>做出<code>主观下线 (sdown)</code>判断， 并且通过 <code>SENTINEL is-master-down-by-addr</code> 命令互相交流之后， 有足够的Sentinel（可以设置） 都将<code>master</code>标记为<code>主观下线</code>之后，<code>master</code>才会被标记为<code>客观下线</code>，然后开启<code>故障转移(failover)</code>。</p> <p><strong>详解：</strong></p> <p>sentinel通过发送<code>SENTINEL is-master-down-by-addr &lt;ip&gt; &lt;port&gt; &lt;current_epoch&gt; &lt;runid&gt;</code>命令，来询问其它sentinel是否同意服务下线。</p> <ul><li>ip：被Sentinel判断为主观下线的主服务器的IP地址</li> <li>port：被Sentinel判断为主观下线的主服务器的端口号</li> <li>current_epoch：Sentinel当前的配置纪元，用于选举领头Sentinel</li> <li>runid：<code>*</code>表示检测服务下线状态，如果是sentinel 运行id，表示用来选举领头sentinel</li></ul> <p>一个sentinel接收另一个sentinel发来的<code>is-master-down-by-addr</code>后，提取参数，根据ip和端口，检测Master是否已<code>主观下线</code>。并且回复<code>is-master-down-by-addr</code>，回复包含三个参数：</p> <ul><li>down_state：返回目标Sentinel对Master的检查结果，1代表主服务器已下线，0代表主服务器未下线</li> <li>leader_runid：Sentinel运行ID用于选举领头Sentinel</li> <li>leader_epoch：领头sentinel纪元</li></ul> <p>sentinel接收到回复后，根据配置设置的下线最小数量，达到这个值，既认为该服务客观下线。</p> <p><strong>客观下线条件只适用于主服务器</strong>： 对于任何其他类型的 Redis 实例， Sentinel 在将它们判断为下线前不需要进行协商， 所以从服务器或者其他 Sentinel 永远不会达到客观下线条件。只要一个 Sentinel 发现某个主服务器进入了客观下线状态， 这个 Sentinel 就可能会被其他 Sentinel 推选出， 并对失效的主服务器执行自动故障迁移操作，故障转移是自动完成的。</p> <h2 id="配置传播"><a href="#配置传播" class="header-anchor">#</a> 配置传播</h2> <p>一旦一个sentinel成功地对一个master进行了<code>failover(故障转移)</code>，它将会把关于master的最新配置通过广播形式通知其它sentinel，其它的sentinel则更新对应master的配置。
一个faiover(故障转移)要想被成功实行，sentinel必须能够向选为master的slave发送<code>SLAVEOF NO ONE</code>命令，然后能够通过INFO命令看到新master的配置信息。
当将一个slave选举为master并发送<code>SLAVEOF NO ONE</code>后，即使其它的slave还没针对新master重新配置自己，failover也被认为是成功了的，然后所有sentinels将会发布新的配置信息。
新配在集群中相互传播的方式，就是为什么我们需要当一个sentinel进行failover时必须被授权一个版本号的原因。
每个sentinel使用##发布/订阅##的方式持续地传播master的配置版本信息，配置传播的##发布/订阅##管道是：<strong>sentinel</strong>:hello。
因为每一个配置都有一个版本号，所以以版本号最大的那个为标准。</p> <p>举个例子：
假设有一个名为mymaster的地址为192.168.10.202:6379。一开始，集群中所有的sentinel都知道这个地址，于是为mymaster的配置打上版本号1。一段时候后mymaster死了，有一个sentinel被授权用版本号2对其进行failover。如果failover成功了，假设地址改为了192.168.10.202:9000，此时配置的版本号为2，进行failover的sentinel会将新配置广播给其他的sentinel，由于其他sentinel维护的版本号为1，发现新配置的版本号为2时，版本号变大了，说明配置更新了，于是就会采用最新的版本号为2的配置。
这意味着sentinel集群保证了第二种活跃性：一个能够互相通信的sentinel集群最终会采用版本号最高且相同的配置。</p> <h2 id="sentinel的-仲裁会"><a href="#sentinel的-仲裁会" class="header-anchor">#</a> sentinel的“仲裁会”</h2> <p>前面我们谈到，当一个master被sentinel集群监控时，需要为它指定一个参数，这个参数指定了当需要判决master为不可用，并且进行failover(故障转移)时，所需要的sentinel数量，可以称这个参数为票数</p> <p>不过，当failover(故障转移)主备切换真正被触发后，failover(故障转移)并不会马上进行，还需要sentinel中的大多数sentinel授权后才可以进行failover。
当<code>ODOWN</code>时，failover被触发。failover一旦被触发，尝试去进行failover的sentinel会去获得“大多数”sentinel的授权（如果票数比大多数还要大的时候，则询问更多的sentinel)
这个区别看起来很微妙，但是很容易理解和使用。例如，集群中有5个sentinel，票数被设置为2，当2个sentinel认为一个master已经不可用了以后，将会触发failover，但是，进行failover的那个sentinel必须先获得至少3个sentinel的授权才可以实行failover。
如果票数被设置为5，要达到ODOWN状态，必须所有5个sentinel都主观认为master为不可用，要进行failover，那么得获得所有5个sentinel的授权。</p> <h2 id="slave选举与优先级"><a href="#slave选举与优先级" class="header-anchor">#</a> Slave选举与优先级</h2> <p>当一个sentinel准备好了要进行failover，并且收到了其他sentinel的授权，那么就需要选举出一个合适的slave来做为新的master。</p> <p>slave的选举主要会评估slave的以下几个方面：</p> <ul><li>与master断开连接的次数</li> <li>Slave的优先级</li> <li>数据复制的下标(用来评估slave当前拥有多少master的数据)</li> <li>进程ID</li></ul> <p>如果一个slave与master失去联系超过10次，并且每次都超过了配置的最大失联时间(down-after-milliseconds)，如果sentinel在进行failover时发现slave失联，那么这个slave就会被sentinel认为不适合用来做新master的。
更严格的定义是，如果一个slave持续断开连接的时间超过
(down-after-milliseconds * 10) + milliseconds_since_master_is_in_SDOWN_state
就会被认为失去选举资格。</p> <p>符合上述条件的slave才会被列入master候选人列表，并根据以下顺序来进行排序：</p> <ul><li>sentinel首先会根据slaves的优先级来进行排序，优先级越小排名越靠前。</li> <li>如果优先级相同，则查看复制的下标，哪个从master接收的复制数据多，哪个就靠前。</li> <li>如果优先级和下标都相同，就选择进程ID较小的那个。</li></ul> <p>一个redis无论是master还是slave，都必须在配置中指定一个slave优先级。要注意到master也是有可能通过failover变成slave的。
如果一个redis的slave优先级配置为0，那么它将永远不会被选为master。但是它依然会从master哪里复制数据。</p></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">更新时间:</span> <span class="time">8/12/2021, 6:20:26 AM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/view/database/redis/masterSlave.html" class="prev">
        Redis主从复制
      </a></span> <!----></p></div> </main></div><div class="global-ui"><!----><!----></div></div>
    <script src="/assets/js/app.6cd24fb3.js" defer></script><script src="/assets/js/2.3a807b85.js" defer></script><script src="/assets/js/32.7d05b40e.js" defer></script><script src="/assets/js/3.dcc3d320.js" defer></script>
  </body>
</html>
