import{e as n}from"./app.179b8d1c.js";import{_ as s}from"./plugin-vue_export-helper.5a098b48.js";const a={},t=n(`<h1 id="\u6D41\u7A0B\u5B9A\u4E49\u4E0E\u6D41\u7A0B\u5B9E\u4F8B" tabindex="-1"><a class="header-anchor" href="#\u6D41\u7A0B\u5B9A\u4E49\u4E0E\u6D41\u7A0B\u5B9E\u4F8B" aria-hidden="true">#</a> \u6D41\u7A0B\u5B9A\u4E49\u4E0E\u6D41\u7A0B\u5B9E\u4F8B</h1><ul><li>\u6D41\u7A0B\u5B9A\u4E49\uFF1A\u5728\u4F7F\u7528 flowable \u7684\u65F6\u5019\uFF0C\u6211\u4EEC\u9996\u5148\u9700\u8981\u753B\u4E00\u4E2A\u6D41\u7A0B\u56FE\uFF0C\u8981\u5728\u6211\u4EEC\u7684\u4EE3\u7801\u4E2D\u4F7F\u7528\u6D41\u7A0B\u56FE\uFF0C\u5C31\u5FC5\u987B\u5148\u628A\u6D41\u7A0B\u56FE\u90E8\u7F72\u5230\u9879\u76EE\u4E2D\u3002\u52A0\u8F7D\u5230\u7CFB\u7EDF\u4E2D\u7684\u6D41\u7A0B\u56FE\uFF0C\u5C31\u662F\u6D41\u7A0B\u5B9A\u4E49\uFF1AProcessDefinition\u3002</li><li>\u6D41\u7A0B\u5B9E\u4F8B\uFF1A\u6211\u4EEC\u542F\u52A8\u7684\u6BCF\u4E00\u4E2A\u5177\u4F53\u7684\u6D41\u7A0B\uFF0C\u5C31\u662F\u4E00\u4E2A\u6D41\u7A0B\u5B9E\u4F8B ProcessInstance\u3002</li></ul><p>ProcessDefinition \u76F8\u5F53\u4E8E Java \u4E2D\u7684\u7C7B\uFF0CProcessInstance \u5219\u76F8\u5F53\u4E8E\u6839\u636E\u8FD9\u4E2A\u7C7B\u521B\u5EFA\u51FA\u6765\u7684\u5BF9\u8C61\u3002</p><h2 id="\u6D41\u7A0B\u5B9A\u4E49-processdefinition" tabindex="-1"><a class="header-anchor" href="#\u6D41\u7A0B\u5B9A\u4E49-processdefinition" aria-hidden="true">#</a> \u6D41\u7A0B\u5B9A\u4E49\uFF08ProcessDefinition\uFF09</h2><h3 id="\u81EA\u52A8\u90E8\u7F72" tabindex="-1"><a class="header-anchor" href="#\u81EA\u52A8\u90E8\u7F72" aria-hidden="true">#</a> \u81EA\u52A8\u90E8\u7F72</h3><p>\u5728 Spring Boot \u4E2D\uFF0C\u51E1\u662F\u653E\u5728 resources/processes \u76EE\u5F55\u4E0B\u7684\u6D41\u7A0B\u6587\u4EF6\uFF0C\u9ED8\u8BA4\u60C5\u51B5\u4E0B\uFF0C\u90FD\u4F1A\u88AB\u81EA\u52A8\u90E8\u7F72\u3002</p><p>\u521B\u5EFA Spring Boot \u9879\u76EE\uFF0C\u6DFB\u52A0 flowable \u4F9D\u8D56\uFF0C\u5E76\u914D\u7F6E application.properties\uFF1A</p><div class="language-properties ext-properties"><pre class="language-properties"><code><span class="token attr-name">spring.datasource.username</span><span class="token punctuation">=</span><span class="token attr-value">root</span>
<span class="token attr-name">spring.datasource.password</span><span class="token punctuation">=</span><span class="token attr-value">123</span>
<span class="token attr-name">spring.datasource.url</span><span class="token punctuation">=</span><span class="token attr-value">jdbc:mysql:///flowable_process?serverTimezone=Asia/Shanghai&amp;useSSL=false&amp;nullCatalogMeansCurrent=true</span>

<span class="token attr-name">logging.level.org.flowable</span><span class="token punctuation">=</span><span class="token attr-value">debug</span>
</code></pre></div><p>\u542F\u52A8 Spring Boot \u9879\u76EE\uFF0C\u542F\u52A8\u4E4B\u540E\uFF0C\u8FD9\u4E2A\u6D41\u7A0B\u5C31\u88AB\u81EA\u52A8\u90E8\u7F72\u4E86\u3002</p><p><code>ACT_RE_DEPLOYMENT</code> \u548C <code>ACT_RE_PROCDEF</code> \u5206\u522B\u4FDD\u5B58\u4E86\u6D41\u7A0B\u5B9A\u4E49\u76F8\u5173\u7684\u4FE1\u606F\u3002<code>ACT_GE_BYTEARRAY</code> \u8868\u5219\u4FDD\u5B58\u4E86\u521A\u521A\u5B9A\u4E49\u7684\u6D41\u7A0B\u7684 XML \u6587\u4EF6\u4EE5\u53CA\u6839\u636E\u8FD9\u4E2A XML \u6587\u4EF6\u6240\u81EA\u52A8\u751F\u6210\u7684\u6D41\u7A0B\u56FE\u3002</p><p>\u4E09\u5F20\u8868\u7684\u5173\u7CFB\uFF1A</p><ul><li><code>ACT_RE_DEPLOYMENT</code> \u548C <code>ACT_RE_PROCDEF</code> \u662F\u4E00\u5BF9\u4E00\u7684\u5173\u7CFB\u3002</li><li><code>ACT_RE_DEPLOYMENT</code>\u548C<code>ACT_GE_BYTEARRAY</code>\u662F\u4E00\u5BF9\u591A\u7684\u5173\u7CFB\uFF0C\u4E00\u4E2A\u6D41\u7A0B\u90E8\u7F72 ID \u5BF9\u5E94\u4E24\u6761ACT_GE_BYTEARRAY\u8868\u4E2D\u7684\u8BB0\u5F55\uFF08\u9ED8\u8BA4\uFF09\u3002</li></ul><p>\u6D41\u7A0B \u90E8\u7F72\u597D\u4E4B\u540E\uFF0C\u5982\u679C\u60F3\u8981\u4FEE\u6539\uFF0C\u53EF\u4EE5\u76F4\u63A5\u4FEE\u6539\uFF0C\u4FEE\u6539\u4E4B\u540E\uFF0C\u6D41\u7A0B\u4F1A\u81EA\u52A8\u5347\u7EA7\uFF08\u6570\u636E\u5E93\u4E2D\u7684\u8BB0\u5F55\u4F1A\u81EA\u52A8\u66F4\u65B0\uFF09\u3002</p><p>\u4E3E\u4E2A\u4F8B\u5B50\uFF1A</p><div class="custom-container tip"><p class="custom-container-title">TIP</p><p>\u5047\u8BBE\u6211\u4EEC\u73B0\u5728\u4FEE\u6539\u4E86\u6D41\u7A0B\u5B9A\u4E49\u7684\u540D\u5B57\uFF0C\u7136\u540E\u91CD\u65B0\u542F\u52A8 Spring Boot \u9879\u76EE\uFF0C\u90A3\u4E48 <code>ACT_RE_DEPLOYMENT</code> \u8868\u4E2D\u4F1A\u589E\u52A0\u4E00\u6761\u90E8\u7F72\u8BB0\u5F55\uFF0C\u540C\u65F6 <code>ACT_RE_PROCDEF</code> \u8868\u4E5F\u4F1A\u589E\u52A0\u4E00\u6761\u65B0\u7684\u6D41\u7A0B\u5B9A\u4E49\u4FE1\u606F\uFF0C\u65B0\u7684\u6D41\u7A0B\u4FE1\u606F\u4E2D\uFF0C\u8BE5\u53D8\u7684\u5B57\u6BB5\u4F1A\u81EA\u52A8\u53D8\uFF0C\u540C\u65F6\u7248\u672C\u53F7 <code>VERSION_</code> \u4F1A\u81EA\u589E 1\u3002<code>ACT_GE_BYTEARRAY</code> \u8868\u4E2D\u4E5F\u4F1A\u65B0\u589E\u4E24\u6761\u8BB0\u5F55\uFF0C\u548C\u6700\u65B0\u7684\u7248\u672C\u53F7\u7684\u5B9A\u4E49\u76F8\u5BF9\u5E94\u3002</p></div><p><strong>\u6CE8\u610F\uFF1A\u6D41\u7A0B\u56FE\u7684\u66F4\u65B0\uFF0C\u4E3B\u8981\u662F\u4EE5\u6D41\u7A0B\u5B9A\u4E49\u7684 id \u4E3A\u4F9D\u636E\uFF0C\u5982\u679C\u6D41\u7A0B\u5B9A\u4E49\u7684\u5185\u5BB9\u53D1\u751F\u53D8\u5316\uFF0C\u4F46\u662F\u6D41\u7A0B id \u6CA1\u6709\u53D8\uFF0C\u5219\u6D41\u7A0B\u5B9A\u4E49\u5347\u7EA7\uFF1B\u5982\u679C\u6D41\u7A0B\u56FE\u5B9A\u4E49\u7684 id \u53D1\u751F\u53D8\u5316\uFF0C\u5219\u76F4\u63A5\u91CD\u65B0\u90E8\u7F72\u65B0\u7684\u6D41\u7A0B\u3002</strong></p><p>Spring Boot \u4E2D\uFF0C\u5173\u4E8E\u6D41\u7A0B\u5B9A\u4E49\u7684\u51E0\u4E2A\u91CD\u8981\u5C5E\u6027\uFF1A</p><div class="language-properties ext-properties"><pre class="language-properties"><code>
<span class="token comment"># \u662F\u5426\u5728\u9879\u76EE\u542F\u52A8\u7684\u65F6\u5019\uFF0C\u81EA\u52A8\u53BB\u68C0\u67E5\u6D41\u7A0B\u5B9A\u4E49\u76EE\u5F55\u4E0B\u662F\u5426\u6709\u5BF9\u5E94\u7684\u6D41\u7A0B\u5B9A\u4E49\u6587\u4EF6\uFF0C\u5982\u679C\u8FD9\u4E2A\u5C5E\u6027\u4E3A true\uFF08\u9ED8\u8BA4\u5373\u6B21\uFF09\uFF0C\u5C31\u8868\u793A\u53BB\u68C0\u67E5\uFF0C\u5426\u5219\u4E0D\u68C0\u67E5\uFF08\u610F\u5473\u7740\u4E0D\u4F1A\u81EA\u52A8\u90E8\u7F72\u6D41\u7A0B\uFF09</span>
<span class="token attr-name">flowable.check-process-definitions</span><span class="token punctuation">=</span><span class="token attr-value">true</span>
<span class="token comment"># \u8BBE\u7F6E\u6D41\u7A0B\u5B9A\u4E49\u6587\u4EF6\u7684\u4F4D\u7F6E\uFF0C\u9ED8\u8BA4\u4F4D\u7F6E\u5C31\u662F classpath*:/processes/</span>
<span class="token attr-name">flowable.process-definition-location-prefix</span><span class="token punctuation">=</span><span class="token attr-value">classpath*:/javaboy/</span>
<span class="token comment"># \u8FD9\u4E2A\u662F\u6307\u5B9A\u6D41\u7A0B\u5B9A\u4E49 XML \u6587\u4EF6\u7684\u540E\u7F00\uFF0C\u9ED8\u8BA4\u540E\u7F00\u6709\u4E24\u4E2A\uFF1A**.bpmn20.xml,**.bpmn</span>
<span class="token attr-name">flowable.process-definition-location-suffixes</span><span class="token punctuation">=</span><span class="token attr-value">**.bpmn20.xml,**.bpmn</span>

</code></pre></div><h3 id="\u624B\u52A8\u90E8\u7F72" tabindex="-1"><a class="header-anchor" href="#\u624B\u52A8\u90E8\u7F72" aria-hidden="true">#</a> \u624B\u52A8\u90E8\u7F72</h3><p>\u9879\u76EE\u542F\u52A8\u6210\u529F\u4E4B\u540E\uFF0C\u518D\u53BB\u90E8\u7F72\u6D41\u7A0B\u3002\u624B\u52A8\u90E8\u7F72\u5176\u5B9E\u5C31\u662F\u4E0A\u4F20 bpmn\u6587\u4EF6\uFF0C\u8BFB\u53D6\u6587\u4EF6\u4E2D\u7684\u4FE1\u606F\u3002</p><p>\u8BFB\u53D6\u6587\u4EF6\u7684\u65B9\u5F0F\u6709\u591A\u79CD\uFF0C\u5982\u4E0B\uFF1A</p><p><img src="https://img.zxqs.top/image-20221215221809931.png" alt="image-20221215221809931"></p><p>\u8FD9\u91CC\u6211\u4EEC\u53EA\u4ECB\u7ECD\u4E24\u79CD\uFF0CaddBytes \u548C addInputStream</p><div class="language-java ext-java"><pre class="language-java"><code><span class="token annotation punctuation">@RestController</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ProcessDeployController</span> <span class="token punctuation">{</span>
    <span class="token doc-comment comment">/**
     * \u8FD9\u4E2A\u5B9E\u4F53\u7C7B\u53EF\u4EE5\u7528\u6765\u64CD\u4F5C act_re_XXX \u8FD9\u79CD\u8868
     */</span>
    <span class="token annotation punctuation">@Autowired</span>
    <span class="token class-name">RepositoryService</span> repositoryService<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/file&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">RespBean</span> <span class="token function">deploy</span><span class="token punctuation">(</span><span class="token class-name">MultipartFile</span> file<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
        <span class="token class-name">DeploymentBuilder</span> deploymentBuilder <span class="token operator">=</span> repositoryService
                <span class="token comment">// \u5F00\u59CB\u6D41\u7A0B\u90E8\u7F72\u7684\u6784\u5EFA</span>
                <span class="token punctuation">.</span><span class="token function">createDeployment</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">name</span><span class="token punctuation">(</span><span class="token string">&quot;YSMC \u7684\u5DE5\u4F5C\u6D41&quot;</span><span class="token punctuation">)</span>      <span class="token comment">// act_re_deployment \u8868\u4E2D\u7684 NAME_\u5B57\u6BB5</span>
                <span class="token punctuation">.</span><span class="token function">category</span><span class="token punctuation">(</span><span class="token string">&quot;\u6211\u7684\u6D41\u7A0B\u5206\u7C7B&quot;</span><span class="token punctuation">)</span>   <span class="token comment">// act_re_deployment \u8868\u4E2D CATEGORY_ \u5B57\u6BB5</span>
                <span class="token punctuation">.</span><span class="token function">key</span><span class="token punctuation">(</span><span class="token string">&quot;\u6211\u7684\u81EA\u5B9A\u4E49\u5DE5\u4F5C\u6D41\u7684 KEY&quot;</span><span class="token punctuation">)</span> <span class="token comment">// act_re_deployment \u8868\u4E2D\u7684 KEY_ \u5B57\u6BB5</span>
                <span class="token comment">// \u8BBE\u7F6E\u6587\u4EF6\u7684\u8F93\u5165\u6D41\u7A0B\uFF0C\u5C06\u901A\u8FC7\u8FD9\u4E2A\u8F93\u5165\u6D41\u81EA\u52A8\u8BFB\u53D6 XML \u6587\u4EF6</span>
                <span class="token punctuation">.</span><span class="token function">addInputStream</span><span class="token punctuation">(</span>file<span class="token punctuation">.</span><span class="token function">getOriginalFilename</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> file<span class="token punctuation">.</span><span class="token function">getInputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// \u5B8C\u6210\u9879\u76EE\u7684\u90E8\u7F72</span>
        <span class="token class-name">Deployment</span> deploy <span class="token operator">=</span> deploymentBuilder<span class="token punctuation">.</span><span class="token function">deploy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">return</span> <span class="token class-name">RespBean</span><span class="token punctuation">.</span><span class="token function">ok</span><span class="token punctuation">(</span><span class="token string">&quot;\u90E8\u7F72\u6210\u529F&quot;</span><span class="token punctuation">,</span>deploy<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/file2&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">RespBean</span> <span class="token function">deploy2</span><span class="token punctuation">(</span><span class="token class-name">MultipartFile</span> file<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>

        <span class="token class-name">ByteArrayOutputStream</span> outputStream <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ByteArrayOutputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> bytes <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token number">1024</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token class-name">InputStream</span> inputStream <span class="token operator">=</span> file<span class="token punctuation">.</span><span class="token function">getInputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">int</span> length<span class="token punctuation">;</span>

        <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>length <span class="token operator">=</span> inputStream<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span>bytes<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            outputStream<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>bytes<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        outputStream<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        inputStream<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">DeploymentBuilder</span> deploymentBuilder <span class="token operator">=</span> repositoryService
                <span class="token comment">// \u5F00\u59CB\u6D41\u7A0B\u90E8\u7F72\u7684\u6784\u5EFA</span>
                <span class="token punctuation">.</span><span class="token function">createDeployment</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">name</span><span class="token punctuation">(</span><span class="token string">&quot;YSMC \u7684\u5DE5\u4F5C\u6D41&quot;</span><span class="token punctuation">)</span>      <span class="token comment">// act_re_deployment \u8868\u4E2D\u7684 NAME_\u5B57\u6BB5</span>
                <span class="token punctuation">.</span><span class="token function">category</span><span class="token punctuation">(</span><span class="token string">&quot;\u6211\u7684\u6D41\u7A0B\u5206\u7C7B&quot;</span><span class="token punctuation">)</span>   <span class="token comment">// act_re_deployment \u8868\u4E2D CATEGORY_ \u5B57\u6BB5</span>
                <span class="token punctuation">.</span><span class="token function">key</span><span class="token punctuation">(</span><span class="token string">&quot;\u6211\u7684\u81EA\u5B9A\u4E49\u5DE5\u4F5C\u6D41\u7684 KEY&quot;</span><span class="token punctuation">)</span> <span class="token comment">// act_re_deployment \u8868\u4E2D\u7684 KEY_ \u5B57\u6BB5</span>
                <span class="token comment">// \u8BBE\u7F6E\u6587\u4EF6\u7684\u8F93\u5165\u6D41\u7A0B\uFF0C\u5C06\u901A\u8FC7\u8FD9\u4E2A\u8F93\u5165\u6D41\u81EA\u52A8\u8BFB\u53D6 XML \u6587\u4EF6</span>
                <span class="token punctuation">.</span><span class="token function">addBytes</span><span class="token punctuation">(</span>file<span class="token punctuation">.</span><span class="token function">getOriginalFilename</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> outputStream<span class="token punctuation">.</span><span class="token function">toByteArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// \u5B8C\u6210\u9879\u76EE\u7684\u90E8\u7F72</span>
        <span class="token class-name">Deployment</span> deploy <span class="token operator">=</span> deploymentBuilder<span class="token punctuation">.</span><span class="token function">deploy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">return</span> <span class="token class-name">RespBean</span><span class="token punctuation">.</span><span class="token function">ok</span><span class="token punctuation">(</span><span class="token string">&quot;\u90E8\u7F72\u6210\u529F&quot;</span><span class="token punctuation">,</span>deploy<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="\u67E5\u8BE2\u6D41\u7A0B\u5B9A\u4E49" tabindex="-1"><a class="header-anchor" href="#\u67E5\u8BE2\u6D41\u7A0B\u5B9A\u4E49" aria-hidden="true">#</a> \u67E5\u8BE2\u6D41\u7A0B\u5B9A\u4E49</h3><p>\u67E5\u8BE2\u6240\u6709\u7684\u6D41\u7A0B\u5B9A\u4E49\uFF1A</p><div class="language-java ext-java"><pre class="language-java"><code><span class="token annotation punctuation">@SpringBootTest</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ActReTest</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Autowired</span>
    <span class="token class-name">RepositoryService</span> repositoryService<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">Logger</span> logger <span class="token operator">=</span> <span class="token class-name">LoggerFactory</span><span class="token punctuation">.</span><span class="token function">getLogger</span><span class="token punctuation">(</span><span class="token class-name">ActReTest</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token doc-comment comment">/**
     * \u67E5\u8BE2\u6D41\u7A0B\u5B9A\u4E49
     *
     * \u5BF9\u5E94\u7684 SQL \u5982\u4E0B\uFF1A
     *
     * : ==&gt;  Preparing: SELECT RES.* from ACT_RE_PROCDEF RES order by RES.ID_ asc
     * : ==&gt; Parameters:
     * : &lt;==      Total: 2
     */</span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">void</span> <span class="token function">test01</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">//\u67E5\u8BE2\u6240\u6709\u5B9A\u4E49\u7684\u6D41\u7A0B</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ProcessDefinition</span><span class="token punctuation">&gt;</span></span> list <span class="token operator">=</span> repositoryService<span class="token punctuation">.</span><span class="token function">createProcessDefinitionQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">list</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">ProcessDefinition</span> pd <span class="token operator">:</span> list<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            logger<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;id:{},name:{},version:{},category:{}&quot;</span><span class="token punctuation">,</span>pd<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>pd<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>pd<span class="token punctuation">.</span><span class="token function">getVersion</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>pd<span class="token punctuation">.</span><span class="token function">getCategory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>\u6D41\u7A0B\u5B9A\u4E49\u53EF\u80FD\u4F1A\u6709\u591A\u4E2A\u7248\u672C\uFF0C\u67E5\u8BE2\u6240\u6709\u6D41\u7A0B\u7684\u6700\u65B0\u7248\u672C\u4EE3\u7801\u5982\u4E0B\uFF1A</p><div class="language-java ext-java"><pre class="language-java"><code><span class="token doc-comment comment">/**
    * \u67E5\u8BE2\u6240\u6709\u6D41\u7A0B\u7684\u6700\u65B0\u7248\u672C
    * 
    * \u5BF9\u5E94\u7684 SQL\uFF1A
    * 
    * : ==&gt;  Preparing: SELECT RES.* from ACT_RE_PROCDEF RES WHERE RES.VERSION_ = (select max(VERSION_) from ACT_RE_PROCDEF where KEY_ = RES.KEY_ and ( (TENANT_ID_ IS NOT NULL and TENANT_ID_ = RES.TENANT_ID_) or (TENANT_ID_ IS NULL and RES.TENANT_ID_ IS NULL) ) ) order by RES.ID_ asc
    * : ==&gt; Parameters: 
    * : &lt;==      Total: 1
    */</span>
<span class="token annotation punctuation">@Test</span>
<span class="token keyword">void</span> <span class="token function">test02</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ProcessDefinition</span><span class="token punctuation">&gt;</span></span> list <span class="token operator">=</span> repositoryService<span class="token punctuation">.</span><span class="token function">createProcessDefinitionQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token comment">//\u8BBE\u7F6E\u67E5\u8BE2\u6D41\u7A0B\u5B9A\u4E49\u7684\u6700\u65B0\u7248\u672C</span>
            <span class="token punctuation">.</span><span class="token function">latestVersion</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">list</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">ProcessDefinition</span> pd <span class="token operator">:</span> list<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        logger<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;id:{},name:{},version:{},category:{}&quot;</span><span class="token punctuation">,</span>pd<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>pd<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>pd<span class="token punctuation">.</span><span class="token function">getVersion</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>pd<span class="token punctuation">.</span><span class="token function">getCategory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
\`\`

\u6839\u636E\u6D41\u7A0B\u5B9A\u4E49\u7684 key \u53BB\u67E5\u8BE2\uFF1A

\u8FD9\u4E2A key \u5C31\u662F\u6587\u4EF6\u4E2D\u7684 \`process\` \u6807\u7B7E\u4E2D\u7684 id

\`\`\`java
<span class="token doc-comment comment">/**
    * \u6839\u636E\u6D41\u7A0B\u5B9A\u4E49\u7684 key \u53BB\u67E5\u8BE2
    *
    * ==&gt;  Preparing: SELECT RES.* from ACT_RE_PROCDEF RES WHERE RES.KEY_ = ? order by RES.VERSION_ desc
    * ==&gt; Parameters: ysmc_submit_an_expense_account(String)
    * &lt;==      Total: 3
    *
    */</span>
<span class="token annotation punctuation">@Test</span>
<span class="token keyword">void</span> <span class="token function">contextLoads3</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ProcessDefinition</span><span class="token punctuation">&gt;</span></span> list <span class="token operator">=</span> repositoryService<span class="token punctuation">.</span><span class="token function">createProcessDefinitionQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">processDefinitionKey</span><span class="token punctuation">(</span><span class="token string">&quot;ysmc_submit_an_expense_account&quot;</span><span class="token punctuation">)</span>
            <span class="token comment">//\u6309\u7167\u7248\u672C\u53F7\u6392\u5E8F</span>
            <span class="token punctuation">.</span><span class="token function">orderByProcessDefinitionVersion</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">desc</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">list</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token class-name">ProcessDefinition</span> pd <span class="token operator">:</span> list<span class="token punctuation">)</span><span class="token punctuation">{</span>
        logger<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;id:{},name:{},version:{},category:{}&quot;</span><span class="token punctuation">,</span>pd<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>pd<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>pd<span class="token punctuation">.</span><span class="token function">getVersion</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>pd<span class="token punctuation">.</span><span class="token function">getCategory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>\u81EA\u5B9A\u4E49\u67E5\u8BE2\uFF1A</p><div class="language-java ext-java"><pre class="language-java"><code><span class="token doc-comment comment">/**
* \u81EA\u5B9A\u4E49\u67E5\u8BE2
*/</span>
<span class="token annotation punctuation">@Test</span>
<span class="token keyword">void</span> <span class="token function">contextLoads4</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ProcessDefinition</span><span class="token punctuation">&gt;</span></span> list <span class="token operator">=</span> repositoryService<span class="token punctuation">.</span><span class="token function">createNativeProcessDefinitionQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">sql</span><span class="token punctuation">(</span><span class="token string">&quot;select * from ACT_RE_PROCDEF RES WHERE RES.KEY_ = #{key} order by RES.VERSION_ desc&quot;</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">parameter</span><span class="token punctuation">(</span><span class="token string">&quot;key&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;ysmc_submit_an_expense_account&quot;</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">list</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token class-name">ProcessDefinition</span> pd <span class="token operator">:</span> list<span class="token punctuation">)</span><span class="token punctuation">{</span>
        logger<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;id:{},name:{},version:{},category:{}&quot;</span><span class="token punctuation">,</span>pd<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>pd<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>pd<span class="token punctuation">.</span><span class="token function">getVersion</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>pd<span class="token punctuation">.</span><span class="token function">getCategory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="\u67E5\u8BE2\u6D41\u7A0B\u90E8\u7F72" tabindex="-1"><a class="header-anchor" href="#\u67E5\u8BE2\u6D41\u7A0B\u90E8\u7F72" aria-hidden="true">#</a> \u67E5\u8BE2\u6D41\u7A0B\u90E8\u7F72</h3><div class="language-java ext-java"><pre class="language-java"><code><span class="token doc-comment comment">/**
* \u67E5\u8BE2\u6D41\u7A0B\u90E8\u7F72\u4FE1\u606F\uFF0C\u672C\u8D28\u4E0A\u5C31\u662F\u67E5\u8BE2 ACT_RE_DEPLOYMENT \u8868
*/</span>
<span class="token annotation punctuation">@Test</span>
<span class="token keyword">void</span> <span class="token function">contextLoads5</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Deployment</span><span class="token punctuation">&gt;</span></span> list <span class="token operator">=</span> repositoryService<span class="token punctuation">.</span><span class="token function">createDeploymentQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">list</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token class-name">Deployment</span> deployment <span class="token operator">:</span> list<span class="token punctuation">)</span><span class="token punctuation">{</span>
        logger<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;id:{},category:{},,name:{},key:{}&quot;</span><span class="token punctuation">,</span>deployment<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>deployment<span class="token punctuation">.</span><span class="token function">getCategory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>deployment<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>deployment<span class="token punctuation">.</span><span class="token function">getKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>\u6839\u636E\u6D41\u7A0B\u90E8\u7F72\u7684\u5206\u7C7B\u540D\u79F0\u53BB\u67E5\u8BE2\uFF1A</p><div class="language-java ext-java"><pre class="language-java"><code><span class="token doc-comment comment">/**
    * \u6839\u636E\u6D41\u7A0B\u90E8\u7F72\u7684\u5206\u7C7B\uFF0C\u53BB\u67E5\u8BE2\u6D41\u7A0B\u90E8\u7F72\u4FE1\u606F
    *
    * : ==&gt;  Preparing: SELECT RES.* from ACT_RE_DEPLOYMENT RES WHERE RES.CATEGORY_ = ? order by RES.ID_ asc
    * : ==&gt; Parameters: \u6211\u7684\u6D41\u7A0B\u5206\u7C7B(String)
    * : &lt;==      Total: 2
    *
    */</span>
<span class="token annotation punctuation">@Test</span>
<span class="token keyword">void</span> <span class="token function">contextLoads6</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Deployment</span><span class="token punctuation">&gt;</span></span> list <span class="token operator">=</span> repositoryService<span class="token punctuation">.</span><span class="token function">createDeploymentQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token comment">//\u6839\u636E\u6D41\u7A0B\u90E8\u7F72\u7684\u5206\u7C7B\u53BB\u67E5\u8BE2</span>
            <span class="token punctuation">.</span><span class="token function">deploymentCategory</span><span class="token punctuation">(</span><span class="token string">&quot;\u6211\u7684\u6D41\u7A0B\u5206\u7C7B&quot;</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">list</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Deployment</span> d <span class="token operator">:</span> list<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        logger<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;id:{},category:{},,name:{},key:{}&quot;</span><span class="token punctuation">,</span>d<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>d<span class="token punctuation">.</span><span class="token function">getCategory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>d<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>d<span class="token punctuation">.</span><span class="token function">getKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>\u6839\u636E\u6D41\u7A0B\u90E8\u7F72\u7684 ID \u53BB\u67E5\u8BE2\u6D41\u7A0B\u5B9A\u4E49</p><div class="language-java ext-java"><pre class="language-java"><code><span class="token annotation punctuation">@Test</span>
<span class="token keyword">void</span> <span class="token function">contextLoads7</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Deployment</span><span class="token punctuation">&gt;</span></span> list <span class="token operator">=</span> repositoryService<span class="token punctuation">.</span><span class="token function">createDeploymentQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">list</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Deployment</span> d <span class="token operator">:</span> list<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ProcessDefinition</span><span class="token punctuation">&gt;</span></span> list1 <span class="token operator">=</span> repositoryService<span class="token punctuation">.</span><span class="token function">createProcessDefinitionQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">deploymentId</span><span class="token punctuation">(</span>d<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">list</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">ProcessDefinition</span> pd <span class="token operator">:</span> list1<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            logger<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;id:{},name:{},version:{},category:{}&quot;</span><span class="token punctuation">,</span> pd<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> pd<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> pd<span class="token punctuation">.</span><span class="token function">getVersion</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> pd<span class="token punctuation">.</span><span class="token function">getCategory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>\u81EA\u5B9A\u4E49\u6D41\u7A0B\u90E8\u7F72\u67E5\u8BE2 SQL\uFF1A</p><div class="language-java ext-java"><pre class="language-java"><code><span class="token annotation punctuation">@Test</span>
<span class="token keyword">void</span> <span class="token function">contextLoads8</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Deployment</span><span class="token punctuation">&gt;</span></span> list <span class="token operator">=</span> repositoryService<span class="token punctuation">.</span><span class="token function">createNativeDeploymentQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">sql</span><span class="token punctuation">(</span><span class="token string">&quot;SELECT RES.* from ACT_RE_DEPLOYMENT RES WHERE RES.CATEGORY_ = #{category} order by RES.ID_ asc&quot;</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">parameter</span><span class="token punctuation">(</span><span class="token string">&quot;category&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;\u6211\u7684\u6D41\u7A0B\u5206\u7C7B&quot;</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">list</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Deployment</span> d <span class="token operator">:</span> list<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        logger<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;id:{},category:{},,name:{},key:{}&quot;</span><span class="token punctuation">,</span>d<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>d<span class="token punctuation">.</span><span class="token function">getCategory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>d<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>d<span class="token punctuation">.</span><span class="token function">getKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="\u6D41\u7A0B\u90E8\u7F72\u5220\u9664" tabindex="-1"><a class="header-anchor" href="#\u6D41\u7A0B\u90E8\u7F72\u5220\u9664" aria-hidden="true">#</a> \u6D41\u7A0B\u90E8\u7F72\u5220\u9664</h3><p>\u8FD9\u4E2A\u5220\u9664\u64CD\u4F5C\uFF0C\u6D89\u53CA\u5230\u6D41\u7A0B\u90E8\u7F72\u7684\u8868\uFF0C\u90FD\u4F1A\u88AB\u5220\u9664\uFF08\u4E5F\u5C31\u662F\u5220\u9664\u4E00\u4E2A\u6D41\u7A0B\u90E8\u7F72\uFF0C\u90A3\u4E48\u76F8\u5173\u7684<code>act_re_procdef</code>\u3001<code>act_ge_property</code>\u4E2D\u7684\u4FE1\u606F\u4E5F\u4F1A\u88AB\u5220\u9664\uFF09</p><div class="language-java ext-java"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * \u5220\u9664\u4E00\u4E2A\u6D41\u7A0B\u90E8\u7F72
 */</span>
<span class="token annotation punctuation">@Test</span>
<span class="token keyword">void</span> <span class="token function">test09</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Deployment</span><span class="token punctuation">&gt;</span></span> list <span class="token operator">=</span> repositoryService<span class="token punctuation">.</span><span class="token function">createDeploymentQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">list</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Deployment</span> deployment <span class="token operator">:</span> list<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        repositoryService<span class="token punctuation">.</span><span class="token function">deleteDeployment</span><span class="token punctuation">(</span>deployment<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="\u6D41\u7A0B\u5B9E\u4F8B-process-instance" tabindex="-1"><a class="header-anchor" href="#\u6D41\u7A0B\u5B9E\u4F8B-process-instance" aria-hidden="true">#</a> \u6D41\u7A0B\u5B9E\u4F8B\uFF08Process Instance\uFF09</h2><p>\u4E24\u4E2A\u6982\u5FF5\uFF1A</p><ol><li>\u6D41\u7A0B\u5B9E\u4F8B\uFF1AProcessInstance\uFF1A\u901A\u8FC7\u6D41\u7A0B\u5B9A\u4E49\u542F\u52A8\u7684\u4E00\u4E2A\u6D41\u7A0B\uFF0C\u8FD9\u4E2A\u542F\u52A8\u540E\u7684\u6D41\u7A0B\u5C31\u662F\u6D41\u7A0B\u5B9E\u4F8B\uFF0C\u8FD9\u4E2A\u8868\u793A\u4E00\u4E2A\u6D41\u7A0B\u4ECE\u5F00\u59CB\u5230\u7ED3\u675F\u7684\u6700\u5927\u6D41\u7A0B\u5206\u652F\uFF0C\u5728\u4E00\u4E2A\u6D41\u7A0B\u4E2D\uFF0C\u53EA\u5B58\u5728\u4E00\u4E2A\u6D41\u7A0B\u5B9E\u4F8B\uFF08\u6267\u884C\u5B9E\u4F8B\u53EF\u80FD\u6709\u591A\u4E2A\uFF09\uFF0C\u524D\u9762\u8BF4\u7684\u6D41\u7A0B\u5B9A\u4E49\u76F8\u5F53\u4E8E\u662F Java \u7C7B\uFF0C\u8FD9\u91CC\u7684\u6D41\u7A0B\u5B9E\u4F8B\u76F8\u5F53\u4E8E\u662F Java \u5BF9\u8C61\u3002</li><li>\u6267\u884C\u5B9E\u4F8B\uFF1AExecution\uFF1A\u7B80\u5355\u6765\u8BF4\uFF0C\u5728\u4E00\u4E2A\u6D41\u7A0B\u4E2D\uFF0C\u5F00\u59CB\u8282\u70B9\u548C\u7ED3\u675F\u8282\u70B9\u662F\u6D41\u7A0B\u5B9E\u4F8B\uFF0C\u5176\u4F59\u8282\u70B9\u662F\u6267\u884C\u5B9E\u4F8B\u3002\u4ECE\u7C7B\u7684\u7EE7\u627F\u5173\u7CFB\u6765\u8BF4\uFF0CProcessInstance \u5B9E\u9645\u4E0A\u662F Execution \u7684\u5B50\u7C7B\uFF0C\u6240\u4EE5\uFF0C\u6D41\u7A0B\u5B9E\u4F8B\u53EF\u4EE5\u7B97\u662F\u6267\u884C\u5B9E\u4F8B\u7684\u4E00\u79CD\u7279\u6B8A\u60C5\u51B5\u3002 <ol><li>\u5982\u679C\u4E00\u4E2A\u6D41\u7A0B\u56FE\u4E2D\uFF0C\u53EA\u6709\u4E00\u6761\u7EBF\uFF0C\u90A3\u4E48\u4E00\u822C\u6765\u8BF4\uFF0C\u6D41\u7A0B\u5B9E\u4F8B\u548C\u6267\u884C\u5B9E\u4F8B\u5C31\u4E0D\u540C\u3002</li><li>\u5982\u679C\u4E00\u4E2A\u6D41\u7A0B\u56FE\u4E2D\uFF0C\u5305\u542B\u591A\u6761\u7EBF\uFF0C\u90A3\u4E48\u6BCF\u4E00\u6761\u7EBF\u5C31\u662F\u4E00\u4E2A\u6267\u884C\u5B9E\u4F8B\u3002</li></ol></li></ol><h3 id="\u542F\u52A8\u6D41\u7A0B\u5B9E\u4F8B" tabindex="-1"><a class="header-anchor" href="#\u542F\u52A8\u6D41\u7A0B\u5B9E\u4F8B" aria-hidden="true">#</a> \u542F\u52A8\u6D41\u7A0B\u5B9E\u4F8B</h3><p>\u542F\u52A8\u6D41\u7A0B\u65B9\u5F0F\u5982\u4E0B\uFF1A</p><div class="language-java ext-java"><pre class="language-java"><code><span class="token annotation punctuation">@SpringBootTest</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ActRuTest</span> <span class="token punctuation">{</span>

    <span class="token comment">//\u8DDF\u6D41\u7A0B\u8FD0\u884C\u76F8\u5173\u7684\u64CD\u4F5C\uFF0C\u90FD\u5728\u8FD9\u4E2A Bean \u4E2D\uFF0C\u5728 Spring Boot \u4E2D\uFF0C\u8BE5 Bean \u5DF2\u7ECF\u914D\u7F6E\u597D\uFF0C\u53EF\u4EE5\u76F4\u63A5\u4F7F\u7528</span>
    <span class="token annotation punctuation">@Autowired</span>
    <span class="token class-name">RuntimeService</span> runtimeService<span class="token punctuation">;</span>   <span class="token comment">// \u64CD\u4F5C\u7684\u662F act_ru_execution \u8868</span>
    <span class="token annotation punctuation">@Autowired</span>
    <span class="token class-name">IdentityService</span> identityService<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token class-name">RepositoryService</span> repositoryService<span class="token punctuation">;</span>
    <span class="token annotation punctuation">@Autowired</span>
    <span class="token class-name">TaskService</span> taskService<span class="token punctuation">;</span>    

    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">Logger</span> logger <span class="token operator">=</span> <span class="token class-name">LoggerFactory</span><span class="token punctuation">.</span><span class="token function">getLogger</span><span class="token punctuation">(</span><span class="token class-name">ActRuTest</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

     <span class="token doc-comment comment">/**
     * \u5F00\u542F\u4E00\u4E2A\u6D41\u7A0B
     */</span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">void</span> <span class="token function">test1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token comment">// \u8BBE\u7F6E\u6D41\u7A0B\u53D1\u8D77\u4EBA</span>
        <span class="token class-name">Authentication</span><span class="token punctuation">.</span><span class="token function">setAuthenticatedUserId</span><span class="token punctuation">(</span><span class="token string">&quot;wangwu&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> processDefinitionKey <span class="token operator">=</span> <span class="token string">&quot;leave&quot;</span><span class="token punctuation">;</span>
        <span class="token comment">// \u901A\u8FC7\u6D41\u7A0B\u5B9A\u4E49\u7684key\u542F\u52A8\u4E00\u4E2A\u6D41\u7A0B\u5B9E\u4F8B</span>
        <span class="token class-name">ProcessInstance</span> processInstance <span class="token operator">=</span> runtimeService<span class="token punctuation">.</span><span class="token function">startProcessInstanceByKey</span><span class="token punctuation">(</span>processDefinitionKey<span class="token punctuation">)</span><span class="token punctuation">;</span>

        logger<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;definitionId:{},id:{},name:{}&quot;</span><span class="token punctuation">,</span>processInstance<span class="token punctuation">.</span><span class="token function">getProcessDefinitionId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>processInstance<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>processInstance<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// \u4E5F\u53EF\u4EE5\u901A\u8FC7\u6D41\u7A0B\u5B9A\u4E49\u7684 id \u53BB\u542F\u52A8\u4E00\u4E2A\u6D41\u7A0B</span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">void</span> <span class="token function">test2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token comment">// \u8BBE\u7F6E\u6D41\u7A0B\u53D1\u8D77\u4EBA</span>
        identityService<span class="token punctuation">.</span><span class="token function">setAuthenticatedUserId</span><span class="token punctuation">(</span><span class="token string">&quot;zhaoliu&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">ProcessDefinition</span> leave <span class="token operator">=</span> repositoryService<span class="token punctuation">.</span><span class="token function">createProcessDefinitionQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">processDefinitionKey</span><span class="token punctuation">(</span><span class="token string">&quot;leave&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">latestVersion</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">singleResult</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//\u4E5F\u53EF\u4EE5\u901A\u8FC7\u6D41\u7A0B\u5B9A\u4E49\u7684 id \u53BB\u542F\u52A8\u4E00\u4E2A\u6D41\u7A0B\uFF0C\u4F46\u662F\u9700\u8981\u6CE8\u610F\uFF0C\u6D41\u7A0B\u5B9A\u4E49\u7684 id \u9700\u8981\u81EA\u5DF1\u53BB\u67E5\u8BE2\uFF0C\u8FD9\u4E2A id \u5E76\u4E0D\u662F XML \u6587\u4EF6\u4E2D\u5B9A\u4E49\u7684\u6D41\u7A0B ID</span>

        <span class="token class-name">ProcessInstance</span> processInstance <span class="token operator">=</span> runtimeService<span class="token punctuation">.</span><span class="token function">startProcessInstanceById</span><span class="token punctuation">(</span>leave<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        logger<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;definitionId:{},id:{},name:{}&quot;</span><span class="token punctuation">,</span>processInstance<span class="token punctuation">.</span><span class="token function">getProcessDefinitionId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>processInstance<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>processInstance<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>\u5F53\u4E00\u4E2A\u6D41\u7A0B\u542F\u52A8\u6210\u529F\u540E\uFF0C\u6211\u4EEC\u9996\u5148\u53BB\u67E5\u770B <code>ACT_RU_EXECUTION</code> \u8868\uFF0C\u8BE5\u8868\u4E2D\u4FDD\u5B58\u4E86\u6240\u6709\u7684\u6D41\u7A0B\u6267\u884C\u5B9E\u4F8B\u4FE1\u606F\uFF0C\u5305\u62EC\u542F\u52A8\u8282\u70B9\u4EE5\u53CA\u5176\u4ED6\u7684\u4EFB\u52A1\u8282\u70B9\u4FE1\u606F\u90FD\u4FDD\u5B58\u5728\u8FD9\u4E2A\u8868\u4E2D\u3002\u540C\u65F6\uFF0C\u5982\u679C\u8FD9\u4E2A\u8282\u70B9\uFF0C\u8FD8\u662F\u4E00\u4E2A <code>UserTask</code>\uFF0C\u90A3\u4E48\u8FD9\u4E2A\u8282\u70B9\u7684\u4FE1\u606F\u8FD8\u4F1A\u4FDD\u5B58\u5728 <code>ACT_RU_TASK</code> \u8868\u4E2D\uFF08\u8BE5\u8868\u7528\u6765\u4FDD\u5B58 UserTask\uFF09\u3002</p><p>\u53E6\u5916\u8FD8\u6709 <code>ACT_RU_ACTINST</code> \u8868\u4E2D\uFF0C\u4F1A\u4FDD\u5B58\u6D41\u7A0B\u6D3B\u52A8\u7684\u6267\u884C\u60C5\u51B5\u3002</p><p>\u5F53\u7136\uFF0C\u65E0\u8BBA\u54EA\u5F20\u8868\uFF0C\u53EA\u8981\u6D41\u7A0B\u6267\u884C\u7ED3\u675F\uFF0C<code>ACT_RU_</code> \u76F8\u5173\u7684\u8868\u4E2D\u7684\u6570\u636E\u90FD\u4F1A\u88AB\u5220\u9664\u3002</p><p>\u63A5\u4E0B\u6765\uFF0C\u6839\u636E\u7528\u6237\u540D\u53BB\u67E5\u8BE2\u6BCF\u4E00\u4E2A\u7528\u6237\u9700\u8981\u5904\u7406\u7684\u6D41\u7A0B\uFF0C\u5E76\u5904\u7406\uFF1A</p><div class="language-java ext-java"><pre class="language-java"><code><span class="token comment">// \u67E5\u8BE2 wangwu \u9700\u8981\u6267\u884C\u7684\u4EFB\u52A1\uFF0C\u5E76\u5904\u7406</span>
<span class="token annotation punctuation">@Test</span>
<span class="token keyword">void</span> <span class="token function">test3</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Task</span><span class="token punctuation">&gt;</span></span> tasks <span class="token operator">=</span> taskService<span class="token punctuation">.</span><span class="token function">createTaskQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">taskAssignee</span><span class="token punctuation">(</span><span class="token string">&quot;wangwu&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">list</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token class-name">Task</span> task <span class="token operator">:</span> tasks<span class="token punctuation">)</span><span class="token punctuation">{</span>
        logger<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;id:{},assignee:{},name:{}&quot;</span><span class="token punctuation">,</span>task<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>task<span class="token punctuation">.</span><span class="token function">getAssignee</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>task<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// \u738B\u4E94\u5B8C\u6210\u81EA\u5DF1\u7684\u4EFB\u52A1</span>
        taskService<span class="token punctuation">.</span><span class="token function">complete</span><span class="token punctuation">(</span>task<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre></div><div class="custom-container tip"><p class="custom-container-title">TIP</p><p>taskService \u64CD\u4F5C\u7684\u662F act_ru_task \u8868</p><p>\u4E0A\u9762\u4EE3\u7801\u5B8C\u6210\u4E86\u4E24\u4E2A\u64CD\u4F5C</p><ol><li>\u9996\u5148\u53BB ACT_RU_TASK \u8868\u4E2D\u6DFB\u52A0\u4E00\u6761\u8BB0\u5F55\uFF0C\u8FD9\u4E2A\u65B0\u7684\u8BB0\u5F55\uFF0C\u5C31\u662F\u4E3B\u7BA1\u5BA1\u6279\u3002</li><li>\u7136\u540E\u4ECE ACT_RU_TASK \u8868\u4E2D\u5220\u9664\u6389\u4E4B\u524D\u7684\u9700\u8981 wangwu \u5B8C\u6210\u7684\u8BB0\u5F55\u3002</li></ol><p>\u8FD9\u4E24\u4E2A\u64CD\u4F5C\u662F\u5728\u540C\u4E00\u4E2A\u4E8B\u52A1\u4E2D\u5B8C\u6210\u7684\u3002</p><p>\u67E5\u8BE2\u5BF9\u5E94\u7684SQL \u4E3A\uFF1A</p><div class="language-log ext-log"><pre class="language-log"><code><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">&gt;</span>  Preparing<span class="token operator">:</span> SELECT RES<span class="token punctuation">.</span><span class="token operator">*</span> from ACT_RU_TASK RES WHERE RES<span class="token punctuation">.</span>ASSIGNEE_ <span class="token operator">=</span> <span class="token operator">?</span> order by RES<span class="token punctuation">.</span>ID_ asc
<span class="token operator">=</span><span class="token operator">=</span><span class="token operator">&gt;</span> Parameters<span class="token operator">:</span> wangwu<span class="token operator">(</span>String<span class="token operator">)</span>
<span class="token operator">&lt;</span><span class="token operator">=</span><span class="token operator">=</span>      Total<span class="token operator">:</span> <span class="token number">1</span>
</code></pre></div></div><h3 id="\u67E5\u8BE2\u6D41\u7A0B\u662F\u5426\u7ED3\u675F" tabindex="-1"><a class="header-anchor" href="#\u67E5\u8BE2\u6D41\u7A0B\u662F\u5426\u7ED3\u675F" aria-hidden="true">#</a> \u67E5\u8BE2\u6D41\u7A0B\u662F\u5426\u7ED3\u675F</h3><div class="language-java ext-java"><pre class="language-java"><code><span class="token annotation punctuation">@Test</span>
<span class="token keyword">void</span> <span class="token function">test04</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">String</span> processId <span class="token operator">=</span> <span class="token string">&quot;3fbef0ee-6fc2-11ed-b2d2-00ff3bea3f33&quot;</span><span class="token punctuation">;</span>
    <span class="token class-name">ProcessInstance</span> pi <span class="token operator">=</span> runtimeService<span class="token punctuation">.</span><span class="token function">createProcessInstanceQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">processInstanceId</span><span class="token punctuation">(</span>processId<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">singleResult</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>pi <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        logger<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;\u6D41\u7A0B\u6267\u884C\u7ED3\u675F&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
        logger<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;\u6D41\u7A0B\u6B63\u5728\u6267\u884C\u4E2D&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>\u5176\u5B9E\u5C31\u662F\u6839\u636E \u6D41\u7A0B\u5B9E\u4F8Bid \u67E5\u627E\u6D41\u7A0B\u5B9E\u4F8B\uFF0C\u5982\u679C ACT_RU_EXECUTION \u8868\u4E2D\uFF0C\u7531\u4E8E\u5173\u4E8E\u8FD9\u4E2A\u6D41\u7A0B\u7684\u8BB0\u5F55\uFF0C\u8BF4\u660E\u8FD9\u4E2A\u6D41\u7A0B\u8FD8\u5728\u6267\u884C\u4E2D\uFF0C\u5982\u679C ACT_RU_EXECUTION \u8868\u4E2D\uFF0C\u6CA1\u6709\u5173\u4E8E\u8FD9\u4E2A\u6D41\u7A0B\u7684\u8BB0\u5F55\uFF0C\u8BF4\u660E\u8FD9\u4E2A\u6D41\u7A0B\u5DF2\u7ECF\u6267\u884C\u7ED3\u675F\u3002</p><p><strong>\u6CE8\u610F\uFF0C\u867D\u7136\u6211\u4EEC\u662F\u53BB ACT_RU_EXECUTION \u8868\u4E2D\u67E5\u8BE2\uFF0C\u4E14\u8BE5\u8868\u4E2D\u540C\u4E00\u4E2A\u6D41\u7A0B\u5B9E\u4F8B ID \u5BF9\u5E94\u4E86\u591A\u6761\u8BB0\u5F55\uFF0C\u4F46\u662F\u5927\u5BB6\u6CE8\u610F\uFF0C\u8FD9\u91CC\u67E5\u8BE2\u5230\u7684\u5176\u5B9E\u8FD8\u662F\u4E00\u4E2A\u6D41\u7A0B\u5B9E\u4F8B\u3002</strong></p><h3 id="\u67E5\u770B\u8FD0\u884C\u7684\u6D3B\u52A8\u8282\u70B9" tabindex="-1"><a class="header-anchor" href="#\u67E5\u770B\u8FD0\u884C\u7684\u6D3B\u52A8\u8282\u70B9" aria-hidden="true">#</a> \u67E5\u770B\u8FD0\u884C\u7684\u6D3B\u52A8\u8282\u70B9</h3><div class="language-java ext-java"><pre class="language-java"><code><span class="token doc-comment comment">/**
    * \u67E5\u770B\u8FD0\u884C\u6D3B\u52A8\u8282\u70B9\uFF0C\u672C\u8D28\u4E0A\u5176\u5B9E\u5C31\u662F\u67E5\u770B ACT_RU_EXECUTION \u8868
    */</span>
<span class="token annotation punctuation">@Test</span>
<span class="token keyword">void</span> <span class="token function">test05</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Execution</span><span class="token punctuation">&gt;</span></span> list <span class="token operator">=</span> runtimeService<span class="token punctuation">.</span><span class="token function">createExecutionQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">list</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token class-name">Execution</span> execution <span class="token operator">:</span> list<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token comment">//\u67E5\u8BE2\u67D0\u4E00\u4E2A\u6267\u884C\u5B9E\u4F8B\u7684\u6D3B\u52A8\u8282\u70B9</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> activeActivityIds <span class="token operator">=</span> runtimeService<span class="token punctuation">.</span><span class="token function">getActiveActivityIds</span><span class="token punctuation">(</span>execution<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token class-name">String</span> activeActivityId <span class="token operator">:</span> activeActivityIds<span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token comment">//\u8FD9\u91CC\u62FF\u5230\u7684\u5176\u5B9E\u5C31\u662F ACT_RU_EXECUTION \u8868\u4E2D\u7684 ACT_ID_ \u5B57\u6BB5</span>
            logger<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;activeActivityId:{}&quot;</span><span class="token punctuation">,</span> activeActivityId<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="\u5220\u9664\u6D41\u7A0B\u5B9E\u4F8B" tabindex="-1"><a class="header-anchor" href="#\u5220\u9664\u6D41\u7A0B\u5B9E\u4F8B" aria-hidden="true">#</a> \u5220\u9664\u6D41\u7A0B\u5B9E\u4F8B</h3><div class="language-java ext-java"><pre class="language-java"><code> <span class="token doc-comment comment">/**
    *
    * \u5220\u9664\u4E00\u4E2A\u6B63\u5728\u6267\u884C\u7684\u6D41\u7A0B\uFF0C\u6CE8\u610F\u8FD9\u4E2A\u53EA\u4F1A\u5220\u9664\u6B63\u5728\u6267\u884C\u7684\u6D41\u7A0B\u5B9E\u4F8B\u4FE1\u606F\uFF0C\u5E76\u4E0D\u4F1A\u5220\u9664\u5386\u53F2\u6D41\u7A0B\u4FE1\u606F\uFF08\u5386\u53F2\u4FE1\u606F\u88AB\u66F4\u65B0\uFF09\u3002
    *
    * : ==&gt;  Preparing: delete from ACT_RU_VARIABLE where EXECUTION_ID_ = ?
    * : ==&gt; Parameters: 87df7272-3cad-11ed-9026-acde48001122(String)
    * : &lt;==    Updates: 1
    * : ==&gt;  Preparing: delete from ACT_RU_IDENTITYLINK where PROC_INST_ID_ = ?
    * : ==&gt; Parameters: 87df7272-3cad-11ed-9026-acde48001122(String)
    * : &lt;==    Updates: 2
    * : ==&gt;  Preparing: delete from ACT_RU_TASK where ID_ = ? and REV_ = ?
    * : ==&gt; Parameters: 87e4c9a9-3cad-11ed-9026-acde48001122(String), 1(Integer)
    * : &lt;==    Updates: 1
    * : ==&gt;  Preparing: delete from ACT_RU_TASK where EXECUTION_ID_ = ?
    * : ==&gt; Parameters: 87df7272-3cad-11ed-9026-acde48001122(String)
    * : &lt;==    Updates: 0
    * : ==&gt;  Preparing: delete from ACT_RU_ACTINST where PROC_INST_ID_ = ?
    * : ==&gt; Parameters: 87df7272-3cad-11ed-9026-acde48001122(String)
    * : &lt;==    Updates: 3
    * : ==&gt;  Preparing: delete from ACT_RU_ACTINST where PROC_INST_ID_ = ?
    * : ==&gt; Parameters: 87df7272-3cad-11ed-9026-acde48001122(String)
    * : &lt;==    Updates: 0
    * : ==&gt;  Preparing: delete from ACT_RU_EXECUTION where ID_ = ? and REV_ = ?
    * : ==&gt; Parameters: 87e035c5-3cad-11ed-9026-acde48001122(String), 2(Integer)
    * : &lt;==    Updates: 1
    * : ==&gt;  Preparing: delete from ACT_RU_EXECUTION where ID_ = ? and REV_ = ?
    * : ==&gt; Parameters: 87df7272-3cad-11ed-9026-acde48001122(String), 2(Integer)
    * : &lt;==    Updates: 1
    */</span>
<span class="token annotation punctuation">@Test</span>
<span class="token keyword">void</span> <span class="token function">test06</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">String</span> processInstanceId <span class="token operator">=</span> <span class="token string">&quot;3fbef0ee-6fc2-11ed-b2d2-00ff3bea3f33&quot;</span><span class="token punctuation">;</span>
    <span class="token class-name">String</span> deleteReason <span class="token operator">=</span> <span class="token string">&quot;\u60F3\u5220\u9664\u4E86&quot;</span><span class="token punctuation">;</span>
    runtimeService<span class="token punctuation">.</span><span class="token function">deleteProcessInstance</span><span class="token punctuation">(</span>processInstanceId<span class="token punctuation">,</span> deleteReason<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="\u6D41\u7A0B\u7684\u6302\u8D77\u548C\u6062\u590D" tabindex="-1"><a class="header-anchor" href="#\u6D41\u7A0B\u7684\u6302\u8D77\u548C\u6062\u590D" aria-hidden="true">#</a> \u6D41\u7A0B\u7684\u6302\u8D77\u548C\u6062\u590D</h2><h3 id="\u6D41\u7A0B\u5B9A\u4E49\u7684\u6302\u8D77\u548C\u6062\u590D" tabindex="-1"><a class="header-anchor" href="#\u6D41\u7A0B\u5B9A\u4E49\u7684\u6302\u8D77\u548C\u6062\u590D" aria-hidden="true">#</a> \u6D41\u7A0B\u5B9A\u4E49\u7684\u6302\u8D77\u548C\u6062\u590D</h3><p><strong>\u67E5\u770B\u6D41\u7A0B\u5B9A\u4E49\u662F\u5426\u88AB\u6302\u8D77\uFF1A</strong></p><div class="language-java ext-java"><pre class="language-java"><code><span class="token annotation punctuation">@SpringBootTest</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ActReTest</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">Logger</span> logger <span class="token operator">=</span> <span class="token class-name">LoggerFactory</span><span class="token punctuation">.</span><span class="token function">getLogger</span><span class="token punctuation">(</span><span class="token class-name">ActReTest</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token class-name">RuntimeService</span> runtimeService<span class="token punctuation">;</span>           <span class="token comment">// \u64CD\u4F5C\u7684\u662F act_ru_execution \u8868</span>
    <span class="token annotation punctuation">@Autowired</span>
    <span class="token class-name">IdentityService</span> identityService<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token class-name">RepositoryService</span> repositoryService<span class="token punctuation">;</span>
    <span class="token annotation punctuation">@Autowired</span>
    <span class="token class-name">TaskService</span> taskService<span class="token punctuation">;</span>

   <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">void</span> <span class="token function">test7</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ProcessDefinition</span><span class="token punctuation">&gt;</span></span> list <span class="token operator">=</span> repositoryService<span class="token punctuation">.</span><span class="token function">createProcessDefinitionQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">list</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token class-name">ProcessDefinition</span> pd <span class="token operator">:</span> list<span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token comment">// \u6839\u636E\u6D41\u7A0B\u5B9A\u4E49id\u5224\u65AD\u6D41\u7A0B\u5B9A\u4E49\u662F\u5426\u88AB\u6302\u8D77</span>
            <span class="token keyword">boolean</span> processDefinitionSuspended <span class="token operator">=</span> repositoryService<span class="token punctuation">.</span><span class="token function">isProcessDefinitionSuspended</span><span class="token punctuation">(</span>pd<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token keyword">if</span><span class="token punctuation">(</span>processDefinitionSuspended<span class="token punctuation">)</span><span class="token punctuation">{</span>
                logger<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;\u6D41\u7A0B\u5B9A\u4E49 {} \u5DF2\u7ECF\u6302\u8D77&quot;</span><span class="token punctuation">,</span>pd<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                logger<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;\u6D41\u7A0B\u5B9A\u4E49 {} \u6CA1\u6709\u6302\u8D77&quot;</span><span class="token punctuation">,</span>pd<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p><strong>\u6302\u8D77\u4E00\u4E2A\u6D41\u7A0B\u5B9A\u4E49:</strong></p><div class="language-java ext-java"><pre class="language-java"><code><span class="token doc-comment comment">/**
    * \u6302\u8D77\u4E00\u4E2A\u6D41\u7A0B\u5B9A\u4E49
    *
    *
    * \u6267\u884C\u7684 SQL \u5982\u4E0B\uFF1A
    *
    *
    : ==&gt;  Preparing: update ACT_RE_PROCDEF SET REV_ = ?, SUSPENSION_STATE_ = ? where ID_ = ? and REV_ = ?
    : ==&gt; Parameters: 2(Integer), 2(Integer), leave:1:48375905-43e2-11ed-ba47-acde48001122(String), 1(Integer)
    : &lt;==    Updates: 1
    *
    */</span>
<span class="token annotation punctuation">@Test</span>
<span class="token keyword">void</span> <span class="token function">test8</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ProcessDefinition</span><span class="token punctuation">&gt;</span></span> list <span class="token operator">=</span> repositoryService<span class="token punctuation">.</span><span class="token function">createProcessDefinitionQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">list</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token class-name">ProcessDefinition</span> pd <span class="token operator">:</span> list<span class="token punctuation">)</span><span class="token punctuation">{</span>
        repositoryService<span class="token punctuation">.</span><span class="token function">suspendProcessDefinitionById</span><span class="token punctuation">(</span>pd<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        logger<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;{} \u6D41\u7A0B\u5B9A\u4E49\u5DF2\u7ECF\u6302\u8D77&quot;</span><span class="token punctuation">,</span>pd<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>\u6302\u8D77\u4E00\u4E2A\u6D41\u7A0B\u5B9A\u4E49\uFF0C\u672C\u8D28\u4E0A\uFF0C\u5176\u5B9E\u5C31\u662F\u4FEE\u6539 <code>ACT_RE_PROCDEF</code> \u8868\u4E2D\uFF0C\u5BF9\u5E94\u7684\u8BB0\u5F55\u7684 <code>SUSPENSION_STATE_</code> \u5B57\u6BB5\u7684\u72B6\u6001\u503C\u4E3A 2</p><p>\u5BF9\u4E8E\u4E00\u4E2A\u5DF2\u7ECF\u6302\u8D77\u7684\u6D41\u7A0B\u5B9A\u4E49\uFF0C\u662F\u65E0\u6CD5\u636E\u6B64\u542F\u52A8\u4E00\u4E2A\u6D41\u7A0B\u5B9E\u4F8B\u7684\uFF0C\u5F3A\u884C\u542F\u52A8\uFF0C\u4F1A\u629B\u51FA\u5982\u4E0B\u9519\u8BEF\uFF1A</p><div class="language-java ext-java"><pre class="language-java"><code><span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>flowable<span class="token punctuation">.</span>common<span class="token punctuation">.</span>engine<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span>FlowableException</span><span class="token operator">:</span> <span class="token class-name">Cannot</span> start process <span class="token class-name"><span class="token namespace">instance<span class="token punctuation">.</span></span> Process</span> definition javaboy\u7684\u8BF7\u5047\u6D41\u7A0B\u56FE<span class="token number">666</span> <span class="token punctuation">(</span>id <span class="token operator">=</span> leave<span class="token operator">:</span><span class="token number">1</span><span class="token operator">:</span><span class="token number">48375905</span><span class="token operator">-</span><span class="token number">43e2</span><span class="token operator">-</span><span class="token number">11</span>ed<span class="token operator">-</span>ba47<span class="token operator">-</span>acde48001122<span class="token punctuation">)</span> is suspended
</code></pre></div><p><strong>\u6FC0\u6D3B\u4E00\u4E2A\u5DF2\u7ECF\u6302\u8D77\u7684\u6D41\u7A0B\u5B9A\u4E49\uFF1A</strong></p><div class="language-java ext-java"><pre class="language-java"><code><span class="token doc-comment comment">/**
    * \u6FC0\u6D3B\u4E00\u4E2A\u5DF2\u7ECF\u6302\u8D77\u7684\u6D41\u7A0B\u5B9A\u4E49
    *
    * : ==&gt;  Preparing: update ACT_RE_PROCDEF SET REV_ = ?, SUSPENSION_STATE_ = ? where ID_ = ? and REV_ = ?
    * : ==&gt; Parameters: 3(Integer), 1(Integer), leave:1:48375905-43e2-11ed-ba47-acde48001122(String), 2(Integer)
    * : &lt;==    Updates: 1
    *
    * 
    *
    */</span>
<span class="token annotation punctuation">@Test</span>
<span class="token keyword">void</span> <span class="token function">test9</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ProcessDefinition</span><span class="token punctuation">&gt;</span></span> list <span class="token operator">=</span> repositoryService<span class="token punctuation">.</span><span class="token function">createProcessDefinitionQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">list</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token class-name">ProcessDefinition</span> pd <span class="token operator">:</span> list<span class="token punctuation">)</span><span class="token punctuation">{</span>
        repositoryService<span class="token punctuation">.</span><span class="token function">activateProcessDefinitionById</span><span class="token punctuation">(</span>pd<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>\u6FC0\u6D3B\u4E00\u4E2A\u6D41\u7A0B\u5B9A\u4E49\uFF0C\u672C\u8D28\u4E0A\uFF0C\u5176\u5B9E\u5C31\u662F\u5C06 ACT_RE_PROCDEF \u8868\u4E2D\u76F8\u5E94\u8BB0\u5F55\u7684 SUSPENSION_STATE_ \u5B57\u6BB5\u7684\u503C\u6539\u4E3A 1</p><h3 id="\u6D41\u7A0B\u5B9E\u4F8B\u7684\u6302\u8D77\u548C\u6062\u590D" tabindex="-1"><a class="header-anchor" href="#\u6D41\u7A0B\u5B9E\u4F8B\u7684\u6302\u8D77\u548C\u6062\u590D" aria-hidden="true">#</a> \u6D41\u7A0B\u5B9E\u4F8B\u7684\u6302\u8D77\u548C\u6062\u590D</h3><p><strong>\u6302\u8D77\u4E00\u4E2A\u6D41\u7A0B\u5B9E\u4F8B\uFF1A</strong></p><div class="language-java ext-java"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * \u6302\u8D77\u4E00\u4E2A\u6D41\u7A0B\u5B9E\u4F8B
 * 
 * : ==&gt;  Preparing: update ACT_RU_EXECUTION SET REV_ = ?, SUSPENSION_STATE_ = ? where ID_ = ? and REV_ = ?
 * : ==&gt; Parameters: 2(Integer), 2(Integer), dd7000f0-43e5-11ed-bbdc-acde48001122(String), 1(Integer)
 * : &lt;==    Updates: 1
 * : updating: Execution[ id &#39;dd709d33-43e5-11ed-bbdc-acde48001122&#39; ] - activity &#39;sid-2F900F54-E047-40AC-A09C-71181386A6C1&#39; - parent &#39;dd7000f0-43e5-11ed-bbdc-acde4800112
 * : ==&gt;  Preparing: update ACT_RU_EXECUTION SET REV_ = ?, SUSPENSION_STATE_ = ? where ID_ = ? and REV_ = ?
 * : ==&gt; Parameters: 2(Integer), 2(Integer), dd709d33-43e5-11ed-bbdc-acde48001122(String), 1(Integer)
 * : &lt;==    Updates: 1
 * : updating: Task[id=dd746dc7-43e5-11ed-bbdc-acde48001122, name=\u63D0\u4EA4\u8BF7\u5047\u7533\u8BF7]
 * : ==&gt;  Preparing: update ACT_RU_TASK SET REV_ = ?, SUSPENSION_STATE_ = ? where ID_= ? and REV_ = ?
 * : ==&gt; Parameters: 2(Integer), 2(Integer), dd746dc7-43e5-11ed-bbdc-acde48001122(String), 1(Integer)
 * : &lt;==    Updates: 1
 * : updating: ProcessDefinitionEntity[leave:1:cc46d851-43e5-11ed-bdc3-acde48001122]
 * : ==&gt;  Preparing: update ACT_RE_PROCDEF SET REV_ = ?, SUSPENSION_STATE_ = ? where ID_ = ? and REV_ = ?
 * : ==&gt; Parameters: 2(Integer), 2(Integer), leave:1:cc46d851-43e5-11ed-bdc3-acde48001122(String), 1(Integer)
 * : &lt;==    Updates: 1
 * 
 * 
 *
 */</span>
<span class="token annotation punctuation">@Test</span>
<span class="token keyword">void</span> <span class="token function">test07</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//\u67E5\u8BE2\u6240\u6709\u7684\u6D41\u7A0B\u5B9A\u4E49</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ProcessDefinition</span><span class="token punctuation">&gt;</span></span> list <span class="token operator">=</span> repositoryService<span class="token punctuation">.</span><span class="token function">createProcessDefinitionQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">list</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">ProcessDefinition</span> pd <span class="token operator">:</span> list<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">//1. \u6D41\u7A0B\u5B9A\u4E49\u7684 ID</span>
        <span class="token comment">//2. \u662F\u5426\u6302\u8D77\u8FD9\u4E2A\u6D41\u7A0B\u5B9A\u4E49\u6240\u5BF9\u5E94\u7684\u6D41\u7A0B\u5B9E\u4F8B</span>
        <span class="token comment">//3\u3002\u8FD9\u662F\u6302\u8D77\u7684\u65F6\u95F4\uFF0Cnull \u8868\u793A\u7ACB\u5373\u6302\u8D77\uFF0C\u4E5F\u53EF\u4EE5\u7ED9\u4E00\u4E2A\u5177\u4F53\u7684\u65F6\u95F4\uFF0C\u8868\u793A\u5230\u671F\u4E4B\u540E\u624D\u4F1A\u88AB\u6302\u8D77\u3002</span>
        repositoryService<span class="token punctuation">.</span><span class="token function">suspendProcessDefinitionById</span><span class="token punctuation">(</span>pd<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>\u6D41\u7A0B\u5B9A\u4E49\u548C\u6D41\u7A0B\u5B9E\u4F8B\u6302\u8D77\u7684\u65B9\u6CD5\u540D\u662F\u4E00\u6837\u7684\uFF0C\u77E5\u8BC6\u53C2\u6570\u4E0D\u540C\u3002</p><div class="custom-container tip"><p class="custom-container-title">TIP</p><p>\u5BF9\u4E8E\u4E00\u4E2A\u6302\u8D77\u7684\u6D41\u7A0B\u5B9E\u4F8B\uFF0C\u6211\u4EEC\u662F\u65E0\u6CD5\u6267\u884C\u76F8\u5E94\u7684 Task \u7684\uFF0C\u6D41\u7A0B\u5B9E\u4F8B\u7684\u6302\u8D77\uFF0C\u6700\u7EC8\u4E5F\u4F1A\u6302\u8D77\u6D41\u7A0B\u5B9A\u4E49</p><p>\u4E00\u4E2A\u88AB\u6302\u8D77\u7684\u6D41\u7A0B\u5B9E\u4F8B\uFF1A</p><ol><li>\u6D41\u7A0B\u5B9E\u4F8B\u672C\u8EAB\u88AB\u6302\u8D77</li><li>\u6D41\u7A0B\u7684 Task \u88AB\u6302\u8D77\u3002</li></ol><p>\u6240\u4EE5\u6D41\u7A0B\u5B9E\u4F8B\u7684\u6302\u8D77\uFF0C\u4E00\u5171\u6D89\u53CA\u5230\u4E09\u5F20\u8868\uFF0C\u5206\u522B\u662F ACT_RU_EXECUTION\uFF08\u6D41\u7A0B\u5B9E\u4F8B\u88AB\u6302\u8D77\uFF09\u3001ACT_RU_TASK\uFF08\u6D41\u7A0B\u7684 Task \u88AB\u6302\u8D77\uFF09 \u4EE5\u53CA ACT_RE_PROCDEF\uFF08\u6D41\u7A0B\u5B9A\u4E49\u88AB\u6302\u8D77\uFF09</p></div><p>\u5BF9\u4E8E\u4E00\u4E2A\u6302\u8D77\u7684\u6D41\u7A0B\u5B9E\u4F8B\uFF0C\u662F\u65E0\u6CD5\u6267\u884C\u5176 Task \u7684\uFF0C\u5982\u679C\u5F3A\u884C\u6267\u884C\uFF0C\u62A5\u9519\u4FE1\u606F\u5982\u4E0B\uFF1A</p><div class="language-java ext-java"><pre class="language-java"><code><span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>flowable<span class="token punctuation">.</span>common<span class="token punctuation">.</span>engine<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span>FlowableException</span><span class="token operator">:</span> <span class="token class-name">Cannot</span> complete a suspended task
</code></pre></div><p><strong>\u6FC0\u6D3B\u4E00\u4E2A\u5DF2\u7ECF\u6302\u8D77\u7684\u6D41\u7A0B\uFF1A</strong></p><div class="language-java ext-java"><pre class="language-java"><code>
<span class="token doc-comment comment">/**
 * \u6FC0\u6D3B\u4E00\u4E2A\u6302\u8D77\u7684\u6D41\u7A0B\u5B9E\u4F8B
 *
 : ==&gt;  Preparing: update ACT_RE_PROCDEF SET REV_ = ?, SUSPENSION_STATE_ = ? where ID_ = ? and REV_ = ?
 : ==&gt; Parameters: 3(Integer), 1(Integer), leave:1:cc46d851-43e5-11ed-bdc3-acde48001122(String), 2(Integer)
 : &lt;==    Updates: 1
 : updating: ProcessInstance[dd7000f0-43e5-11ed-bbdc-acde48001122]
 : ==&gt;  Preparing: update ACT_RU_EXECUTION SET REV_ = ?, SUSPENSION_STATE_ = ? where ID_ = ? and REV_ = ?
 : ==&gt; Parameters: 3(Integer), 1(Integer), dd7000f0-43e5-11ed-bbdc-acde48001122(String), 2(Integer)
 : &lt;==    Updates: 1
 : updating: Execution[ id &#39;dd709d33-43e5-11ed-bbdc-acde48001122&#39; ] - activity &#39;sid-2F900F54-E047-40AC-A09C-71181386A6C1&#39; - parent &#39;dd7000f0-43e5-11ed-bbdc-acde48001122&#39;
 : ==&gt;  Preparing: update ACT_RU_EXECUTION SET REV_ = ?, SUSPENSION_STATE_ = ? where ID_ = ? and REV_ = ?
 : ==&gt; Parameters: 3(Integer), 1(Integer), dd709d33-43e5-11ed-bbdc-acde48001122(String), 2(Integer)
 : &lt;==    Updates: 1
 : updating: Task[id=dd746dc7-43e5-11ed-bbdc-acde48001122, name=\u63D0\u4EA4\u8BF7\u5047\u7533\u8BF7]
 : ==&gt;  Preparing: update ACT_RU_TASK SET REV_ = ?, SUSPENSION_STATE_ = ? where ID_= ? and REV_ = ?
 : ==&gt; Parameters: 3(Integer), 1(Integer), dd746dc7-43e5-11ed-bbdc-acde48001122(String), 2(Integer)
 : &lt;==    Updates: 1
 *
 */</span>
<span class="token annotation punctuation">@Test</span>
<span class="token keyword">void</span> <span class="token function">test08</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ProcessDefinition</span><span class="token punctuation">&gt;</span></span> list <span class="token operator">=</span> repositoryService<span class="token punctuation">.</span><span class="token function">createProcessDefinitionQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">list</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">ProcessDefinition</span> pd <span class="token operator">:</span> list<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        repositoryService<span class="token punctuation">.</span><span class="token function">activateProcessDefinitionById</span><span class="token punctuation">(</span>pd<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="custom-container tip"><p class="custom-container-title">TIP</p><p>\u6FC0\u6D3B\u5C31\u662F\u6302\u8D77\u7684\u4E00\u4E2A\u53CD\u5411\u64CD\u4F5C\uFF1A</p><p>\u6FC0\u6D3B\uFF0C\u4E5F\u4F1A\u6D89\u53CA\u5230\u4E09\u5F20\u8868\uFF0C\u5206\u522B\u662F\uFF1AACT_RU_EXECUTION\u3001ACT_RU_TASK \u4EE5\u53CA ACT_RE_PROCDEF</p><p>\u6302\u8D77\u662F\u5C06\u8FD9\u4E09\u5F20\u8868\u4E2D\u7684 SUSPENSION_STATE_ \u5B57\u6BB5\uFF0C\u7531 1 \u6539\u4E3A 2</p><p>\u6FC0\u6D3B\u5C31\u662F\u5C06\u8FD9\u4E09\u5F20\u8868\u4E2D\u7684 SUSPENSION_STATE_ \u7531 2 \u6539\u4E3A 1</p></div>`,84);function p(o,e){return t}var l=s(a,[["render",p]]);export{l as default};
