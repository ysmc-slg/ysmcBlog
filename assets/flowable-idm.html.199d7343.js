import{e as n}from"./app.7e2e1522.js";import{_ as s}from"./plugin-vue_export-helper.5a098b48.js";const a={},t=n(`<h1 id="\u64CD\u4F5C\u7528\u6237\u548C\u7528\u6237\u7EC4" tabindex="-1"><a class="header-anchor" href="#\u64CD\u4F5C\u7528\u6237\u548C\u7528\u6237\u7EC4" aria-hidden="true">#</a> \u64CD\u4F5C\u7528\u6237\u548C\u7528\u6237\u7EC4</h1><p>\u9996\u5148\u521B\u5EFA\u4E00\u4E2A springboot \u5DE5\u7A0B\uFF0C\u6DFB\u52A0MySQL\u548Cflowable\u4F9D\u8D56</p><div class="language-xml ext-xml"><pre class="language-xml"><code> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.flowable<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>flowable-spring-boot-starter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>6.7.2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>mysql<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>mysql-connector-java<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">&gt;</span></span>runtime<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>\u7136\u540E\u914D\u7F6E <code>properties</code> \u6587\u4EF6</p><div class="language-prpperties ext-prpperties"><pre class="language-prpperties"><code># \u6570\u636E\u5E93\u9A71\u52A8\uFF1A
spring.datasource.driver-class-name=com.mysql.cj.jdbc.Driver
# \u6570\u636E\u5E93\u8FDE\u63A5\u5730\u5740
spring.datasource.url=jdbc:mysql://localhost:3306/flowable_idm?serverTimezone=Asia/Shanghai&amp;useSSL=false&amp;nullCatalogMeansCurrent=true
# \u6570\u636E\u5E93\u7528\u6237\u540D&amp;\u5BC6\u7801\uFF1A
spring.datasource.username=root
spring.datasource.password=123456

logging.level.org.flowable=debug
</code></pre></div><p>\u542F\u52A8\u9879\u76EE\u540E\u4F1A\u81EA\u52A8\u5728\u6570\u636E\u5E93\u4E2D\u521B\u5EFAflowable\u9700\u8981\u7684\u8868</p><h2 id="\u521B\u5EFA\u4E00\u4E2A\u7528\u6237" tabindex="-1"><a class="header-anchor" href="#\u521B\u5EFA\u4E00\u4E2A\u7528\u6237" aria-hidden="true">#</a> \u521B\u5EFA\u4E00\u4E2A\u7528\u6237</h2><div class="language-java ext-java"><pre class="language-java"><code><span class="token annotation punctuation">@SpringBootTest</span>
<span class="token keyword">class</span> <span class="token class-name">FlowableApplicationTests</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">Logger</span> logger <span class="token operator">=</span> <span class="token class-name">LoggerFactory</span><span class="token punctuation">.</span><span class="token function">getLogger</span><span class="token punctuation">(</span><span class="token class-name">FlowableApplicationTests</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


    <span class="token annotation punctuation">@Autowired</span>
    <span class="token class-name">IdentityService</span> identityService<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token class-name">IdmManagementService</span> idmManagementService<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">void</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// \u7528\u6237\u7684\u5B9E\u4F53\u7C7B\uFF0C\u5BF9\u5E94\u7684\u662F act_id_user \u8868</span>
        <span class="token class-name">UserEntityImpl</span> user <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">UserEntityImpl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        user<span class="token punctuation">.</span><span class="token function">setId</span><span class="token punctuation">(</span><span class="token string">&quot;ysmc&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        user<span class="token punctuation">.</span><span class="token function">setDisplayName</span><span class="token punctuation">(</span><span class="token string">&quot;\u4F59\u751F\u6162\u5C1D&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        user<span class="token punctuation">.</span><span class="token function">setPassword</span><span class="token punctuation">(</span><span class="token string">&quot;123&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        user<span class="token punctuation">.</span><span class="token function">setFirstName</span><span class="token punctuation">(</span><span class="token string">&quot;ysmc&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        user<span class="token punctuation">.</span><span class="token function">setLastName</span><span class="token punctuation">(</span><span class="token string">&quot;ysmc&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        user<span class="token punctuation">.</span><span class="token function">setEmail</span><span class="token punctuation">(</span><span class="token string">&quot;ysmc@qq.com&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// \u6CE8\u610F\uFF1A\u5982\u679C\u662F\u6DFB\u52A0\u7528\u6237\uFF0C\u4E00\u5B9A\u8981\u8BBE\u7F6E Revision \u5C5E\u6027\u4E3A0\uFF08\u9ED8\u8BA4\u662F1\uFF09\uFF0C\u8868\u793A\u662F\u4E00\u4E2A\u65B0\u7684\u7528\u6237\uFF0C\u5728 SaveUserCmd.execute \u65B9\u6CD5\u4E2D\u5224\u65AD\u7684</span>
        <span class="token comment">// flowable \u7684\u7528\u6237\u8868\u4F7F\u7528\u4E86\u4E50\u89C2\u9501\uFF0C\u800C revision \u5B57\u6BB5\u5176\u5B9E\u5C31\u662F\u914D\u5408\u4E50\u89C2\u9501\u4F7F\u7528\u7684\u3002</span>
        user<span class="token punctuation">.</span><span class="token function">setRevision</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// \u4FDD\u5B58\u4E00\u4E2A\u7528\u6237</span>
        <span class="token comment">// \u8FD9\u91CC\u6709\u4E24\u4E2A\u529F\u80FD 1. \u5982\u679C\u7528\u6237\u5B58\u5728\uFF0C\u5219\u66F4\u65B0  2. \u5982\u679C\u7528\u6237\u4E0D\u5B58\u5728\uFF0C\u5219\u6DFB\u52A0</span>
        identityService<span class="token punctuation">.</span><span class="token function">saveUser</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="custom-container tip"><p class="custom-container-title">\u6CE8\u610F</p><p>springboot \u5DF2\u7ECF\u5B8C\u6210\u4E86\u4E00\u4E9B\u529F\u80FD\uFF0CidentityService \u8D1F\u8D23\u548C\u7528\u6237\u76F8\u5173\u7684\u64CD\u4F5C\uFF0C\u4F8B\u5982 \u6DFB\u52A0/\u5220\u9664/\u4FEE\u6539\u7528\u6237\u6216\u8005\uFF0C\u6DFB\u52A0/\u5220\u9664/\u4FEE\u6539\u7528\u6237\u7EC4\u7B49</p><p>\u5982\u679C\u662F\u6DFB\u52A0\u7528\u6237\uFF0C\u4E00\u5B9A\u8981\u8BBE\u7F6E <code>Revision</code> \u5C5E\u6027\u4E3A0\uFF08\u9ED8\u8BA4\u662F1\uFF09\uFF0C\u8868\u793A\u662F\u4E00\u4E2A\u65B0\u7684\u7528\u6237\u3002</p></div><h2 id="\u66F4\u65B0\u7528\u6237" tabindex="-1"><a class="header-anchor" href="#\u66F4\u65B0\u7528\u6237" aria-hidden="true">#</a> \u66F4\u65B0\u7528\u6237</h2><div class="language-java ext-java"><pre class="language-java"><code><span class="token annotation punctuation">@Test</span>
<span class="token keyword">void</span> <span class="token function">test02</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">UserEntityImpl</span> user <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">UserEntityImpl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    user<span class="token punctuation">.</span><span class="token function">setId</span><span class="token punctuation">(</span><span class="token string">&quot;ysmc&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    user<span class="token punctuation">.</span><span class="token function">setPassword</span><span class="token punctuation">(</span><span class="token string">&quot;123456&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    user<span class="token punctuation">.</span><span class="token function">setEmail</span><span class="token punctuation">(</span><span class="token string">&quot;ysmc12356@qq.com&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    user<span class="token punctuation">.</span><span class="token function">setRevision</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    identityService<span class="token punctuation">.</span><span class="token function">saveUser</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="custom-container tip"><p class="custom-container-title">\u89E3\u6790</p><p>\u66F4\u65B0\u7528\u6237\u4FE1\u606F saveUser \u65B9\u6CD5\u53EF\u4EE5\u7528\u6765\u66F4\u65B0\u7528\u6237\u4FE1\u606F\uFF0C\u4F46\u662F\u4E0D\u80FD\u66F4\u65B0\u5BC6\u7801\u3002\u6BCF\u4E00\u6B21\u66F4\u65B0\uFF0C\u6570\u636E\u5E93\u4E2D\u7684 Revision \u4F1A\u81EA\u589E 1</p><p>\u4FEE\u6539\u7684\u65F6\u5019\uFF0C\u9700\u8981\u786E\u4FDD Revision \u7684\u7248\u672C\u53F7\u548C\u6570\u636E\u5E93\u4E2D\u7684\u4FDD\u6301\u4E00\u81F4\uFF0C\u5426\u5219\u4F1A\u8BA4\u4E3A\u6709\u5176\u4ED6\u7EBF\u7A0B\u64CD\u4F5C\u6570\u636E\uFF08\u62A5\u9519FlowableOptimisticLockingException\uFF09\uFF0C\u8FD9\u5C31\u662F\u4E00\u4E2A\u4E50\u89C2\u9501\u3002</p></div><p>\u6211\u4EEC\u6BCF\u4E00\u6B21\u66F4\u65B0\u90FD\u8981\u83B7\u53D6\u4E0A\u4E00\u6B21\u66F4\u65B0\u7684 <code>revision</code>\uFF0C\u6240\u4EE5\u9700\u8981\u5148\u67E5\u8BE2\u5728\u4FEE\u6539\uFF1A</p><div class="language-java ext-java"><pre class="language-java"><code><span class="token annotation punctuation">@Test</span>
<span class="token keyword">void</span> <span class="token function">test02</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token comment">// \u6839\u636E userId \u67E5\u8BE2</span>
    <span class="token class-name">User</span> user <span class="token operator">=</span> identityService<span class="token punctuation">.</span><span class="token function">createUserQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">userId</span><span class="token punctuation">(</span><span class="token string">&quot;ysmc&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">singleResult</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    user<span class="token punctuation">.</span><span class="token function">setEmail</span><span class="token punctuation">(</span><span class="token string">&quot;111333@11.com&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    identityService<span class="token punctuation">.</span><span class="token function">saveUser</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>


<span class="token doc-comment comment">/**
 updateUserPassword \u80FD\u4FEE\u6539\u5BC6\u7801\uFF0C\u540C\u65F6\u4E5F\u80FD\u4FEE\u6539\u5176\u4ED6\u5B57\u6BB5
*/</span>
<span class="token annotation punctuation">@Test</span>
<span class="token keyword">void</span> <span class="token function">test03</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token comment">// \u6839\u636E userId \u67E5\u8BE2</span>
    <span class="token class-name">User</span> user <span class="token operator">=</span> identityService<span class="token punctuation">.</span><span class="token function">createUserQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">userId</span><span class="token punctuation">(</span><span class="token string">&quot;ysmc&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">singleResult</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    user<span class="token punctuation">.</span><span class="token function">setEmail</span><span class="token punctuation">(</span><span class="token string">&quot;dsf@df.com&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    user<span class="token punctuation">.</span><span class="token function">setPassword</span><span class="token punctuation">(</span><span class="token string">&quot;888&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    identityService<span class="token punctuation">.</span><span class="token function">updateUserPassword</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="\u67E5\u8BE2\u7528\u6237" tabindex="-1"><a class="header-anchor" href="#\u67E5\u8BE2\u7528\u6237" aria-hidden="true">#</a> \u67E5\u8BE2\u7528\u6237</h2><div class="language-java ext-java"><pre class="language-java"><code><span class="token annotation punctuation">@Test</span>
<span class="token keyword">void</span> <span class="token function">test04</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
   <span class="token class-name">User</span> user <span class="token operator">=</span> identityService<span class="token punctuation">.</span><span class="token function">createUserQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">userId</span><span class="token punctuation">(</span><span class="token string">&quot;ysmc&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">singleResult</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   logger<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;id:{};displayName:{}&quot;</span><span class="token punctuation">,</span>user<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>user<span class="token punctuation">.</span><span class="token function">getDisplayName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   
<span class="token punctuation">}</span>

<span class="token doc-comment comment">/**
    \u67E5\u8BE2\u6240\u6709\u7528\u6237\u5E76\u4E14\u6839\u636E id \u6392\u5E8F
*/</span>
<span class="token annotation punctuation">@Test</span>
<span class="token keyword">void</span> <span class="token function">test05</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> list <span class="token operator">=</span> identityService<span class="token punctuation">.</span><span class="token function">createUserQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">orderByUserId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">desc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">list</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token class-name">User</span> user <span class="token operator">:</span> list<span class="token punctuation">)</span><span class="token punctuation">{</span>
        logger<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;id:{};displayName:{}&quot;</span><span class="token punctuation">,</span>user<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>user<span class="token punctuation">.</span><span class="token function">getDisplayName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre></div><p>\u8FD8\u6709\u6839\u636E \u7528\u6237\u540D\u3001\u90AE\u7BB1\u7B49\u8FDB\u884C\u67E5\u8BE2\uFF0C\u8FD9\u91CC\u5C31\u4E0D\u4E00\u4E00\u5217\u4E3E\u4E86\u3002</p><p>\u9664\u4E86\u4F7F\u7528 springboot \u5C01\u88C5\u597D\u7684\u4EE5\u5916\uFF0C\u4E5F\u53EF\u4EE5\u81EA\u5B9A\u4E49 SQL \u8FDB\u884C\u67E5\u8BE2\uFF0C\u5982\u4E0B\uFF1A</p><div class="language-java ext-java"><pre class="language-java"><code><span class="token annotation punctuation">@Test</span>
<span class="token keyword">void</span> <span class="token function">test06</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token class-name">User</span> email <span class="token operator">=</span> identityService<span class="token punctuation">.</span><span class="token function">createNativeUserQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sql</span><span class="token punctuation">(</span><span class="token string">&quot;select * from act_id_user where EMAIL_=#{email}&quot;</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">parameter</span><span class="token punctuation">(</span><span class="token string">&quot;email&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;dsf@df.com&quot;</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">singleResult</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    logger<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;id:{};displayName:{}&quot;</span><span class="token punctuation">,</span>email<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>email<span class="token punctuation">.</span><span class="token function">getDisplayName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span>

</code></pre></div><p>\u53EF\u4EE5\u770B\u5230\u53C2\u6570\u83B7\u53D6\u65B9\u5F0F\u548C mybatis \u4E00\u6837\uFF0C\u5176\u5B9E\u5E95\u5C42\u4F9D\u8D56\u7684\u5C31\u662F mybatis\u3002</p><h2 id="\u521B\u5EFA\u7528\u6237\u7EC4" tabindex="-1"><a class="header-anchor" href="#\u521B\u5EFA\u7528\u6237\u7EC4" aria-hidden="true">#</a> \u521B\u5EFA\u7528\u6237\u7EC4</h2><div class="language-java ext-java"><pre class="language-java"><code><span class="token annotation punctuation">@Test</span>
<span class="token keyword">void</span> <span class="token function">test07</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token class-name">GroupEntityImpl</span> groupEntity <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">GroupEntityImpl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    groupEntity<span class="token punctuation">.</span><span class="token function">setName</span><span class="token punctuation">(</span><span class="token string">&quot;\u7ECF\u7406&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    groupEntity<span class="token punctuation">.</span><span class="token function">setId</span><span class="token punctuation">(</span><span class="token string">&quot;leader&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    groupEntity<span class="token punctuation">.</span><span class="token function">setRevision</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    identityService<span class="token punctuation">.</span><span class="token function">saveGroup</span><span class="token punctuation">(</span>groupEntity<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="custom-container tip"><p class="custom-container-title">TIP</p><p>GroupEntityImpl\uFF0C\u5BF9\u5E94\u7684\u8868\u662F <code>act_id_group</code></p><p>\u548C \u7528\u6237 \u4E00\u6837\uFF0C\u7528\u6237\u7EC4\u4E2D Revision \u4E5F\u662F\u4E00\u4E2A\u4E50\u89C2\u9501\uFF0CsaveGroup\u4E5F\u53EF\u4EE5\u5B8C\u6210 <code>\u521B\u5EFA</code> \u548C\u4FEE\u6539 <code>\u64CD\u4F5C</code>\u3002</p><p>\u7528\u6237\u548C\u7528\u6237\u7EC4\u662F\u591A\u5BF9\u591A\u7684\u5173\u7CFB\uFF0C\u6570\u636E\u5E93\u5BF9\u5E94\u7684\u8868\u662F <code>act_id_membership</code>\u3002</p></div><p>\u7D27\u63A5\u7740\u6765\u770B\u4E00\u4E0B\uFF0C\u600E\u6837\u6DFB\u52A0\u7528\u6237\u7EC4\u548C\u7528\u6237\u7684\u5173\u8054\u5173\u7CFB\uFF1A</p><div class="language-java ext-java"><pre class="language-java"><code><span class="token annotation punctuation">@Test</span>
<span class="token keyword">void</span> <span class="token function">test08</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token class-name">String</span> userId <span class="token operator">=</span> <span class="token string">&quot;ysmc&quot;</span><span class="token punctuation">;</span>
    <span class="token class-name">String</span> groupId <span class="token operator">=</span> <span class="token string">&quot;managers&quot;</span><span class="token punctuation">;</span>
    <span class="token comment">// \u6DFB\u52A0\u7528\u6237\u7EC4\u548C\u7528\u6237\u7684\u5173\u8054\u5173\u7CFB</span>
    identityService<span class="token punctuation">.</span><span class="token function">createMembership</span><span class="token punctuation">(</span>userId<span class="token punctuation">,</span>groupId<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>\u8FD9\u91CC\uFF0C\u8868\u7684\u5E95\u5C42\u4F7F\u7528\u4E86 <code>\u5916\u952E</code>\uFF0C\u6240\u4EE5\u8981\u786E\u4FDD\u4F20\u9012\u7684\u53C2\u6570\u5728 <code>act_id_group</code> \u548C<code>act_id_user</code> \u8868\u4E2D\u90FD\u662F\u771F\u5B9E\u5B58\u5728\u7684\u5426\u5219\u4F1A\u62A5\u9519\u3002</p><p>\u6267\u884Csql \u5982\u4E0B\uFF1A</p><div class="language-log ext-log"><pre class="language-log"><code><span class="token operator">:</span> <span class="token operator">=</span><span class="token operator">=</span><span class="token operator">&gt;</span>  Preparing<span class="token operator">:</span> insert into ACT_ID_MEMBERSHIP <span class="token operator">(</span>USER_ID_<span class="token punctuation">,</span> GROUP_ID_<span class="token operator">)</span> values <span class="token operator">(</span> <span class="token operator">?</span><span class="token punctuation">,</span> <span class="token operator">?</span> <span class="token operator">)</span>
<span class="token operator">:</span> <span class="token operator">=</span><span class="token operator">=</span><span class="token operator">&gt;</span> Parameters<span class="token operator">:</span> ysmc<span class="token operator">(</span>String<span class="token operator">)</span><span class="token punctuation">,</span> managers<span class="token operator">(</span>String<span class="token operator">)</span>
<span class="token operator">:</span> <span class="token operator">&lt;</span><span class="token operator">=</span><span class="token operator">=</span>    Updates<span class="token operator">:</span> <span class="token number">1</span>
</code></pre></div><h2 id="\u66F4\u65B0\u7528\u6237\u7EC4" tabindex="-1"><a class="header-anchor" href="#\u66F4\u65B0\u7528\u6237\u7EC4" aria-hidden="true">#</a> \u66F4\u65B0\u7528\u6237\u7EC4</h2><p>\u4E5F\u662F\u5148\u67E5\u8BE2\u540E\u4FEE\u6539\uFF1A</p><div class="language-java ext-java"><pre class="language-java"><code><span class="token annotation punctuation">@Test</span>
<span class="token keyword">void</span> <span class="token function">test9</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token class-name">Group</span> managers <span class="token operator">=</span> identityService<span class="token punctuation">.</span><span class="token function">createGroupQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">groupId</span><span class="token punctuation">(</span><span class="token string">&quot;managers&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">singleResult</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    managers<span class="token punctuation">.</span><span class="token function">setName</span><span class="token punctuation">(</span><span class="token string">&quot;CEO&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    identityService<span class="token punctuation">.</span><span class="token function">saveGroup</span><span class="token punctuation">(</span>managers<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="\u67E5\u8BE2\u7528\u6237\u7EC4" tabindex="-1"><a class="header-anchor" href="#\u67E5\u8BE2\u7528\u6237\u7EC4" aria-hidden="true">#</a> \u67E5\u8BE2\u7528\u6237\u7EC4</h2><div class="language-java ext-java"><pre class="language-java"><code><span class="token annotation punctuation">@Test</span>
<span class="token keyword">void</span> <span class="token function">test10</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token class-name">Group</span> ceo <span class="token operator">=</span> identityService<span class="token punctuation">.</span><span class="token function">createGroupQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">groupName</span><span class="token punctuation">(</span><span class="token string">&quot;CEO&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">singleResult</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    logger<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;id:{}.name:{}&quot;</span><span class="token punctuation">,</span>ceo<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>ceo<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>\u8FD9\u91CC\u503C\u5C55\u793A\u6839\u636E\u7528\u6237\u7EC4\u7684\u540D\u79F0\u8FDB\u884C\u67E5\u627E</p><p><strong>\u6839\u636E\u7528\u6237\u540D\u67E5\u627E\u7528\u6237\u6240\u5728\u7528\u6237\u7EC4\u7684\u4FE1\u606F\uFF1A</strong></p><p>\u8FD9\u4E2A\u9700\u8981\u591A\u8868\u8054\u5408\u67E5\u8BE2\uFF0C\u4E0B\u9762\u6848\u4F8B\uFF0C\u67E5\u8BE2\u5305\u542B ysmc \u8FD9\u4E2A\u7528\u6237\u7684\u7528\u6237\u7EC4</p><div class="language-java ext-java"><pre class="language-java"><code><span class="token annotation punctuation">@Test</span>
<span class="token keyword">void</span> <span class="token function">test11</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Group</span><span class="token punctuation">&gt;</span></span> groups <span class="token operator">=</span> identityService<span class="token punctuation">.</span><span class="token function">createGroupQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">groupMember</span><span class="token punctuation">(</span><span class="token string">&quot;ysmc&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">list</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token class-name">Group</span> group<span class="token operator">:</span>groups<span class="token punctuation">)</span><span class="token punctuation">{</span>
        logger<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;id:{}.name:{}&quot;</span><span class="token punctuation">,</span>group<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>group<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>\u6267\u884C SQL \u5982\u4E0B\uFF1A</p><div class="language-log ext-log"><pre class="language-log"><code><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">&gt;</span>  Preparing<span class="token operator">:</span> SELECT RES<span class="token punctuation">.</span><span class="token operator">*</span> from ACT_ID_GROUP RES WHERE exists<span class="token operator">(</span>select <span class="token number">1</span> from ACT_ID_MEMBERSHIP M where M<span class="token punctuation">.</span>GROUP_ID_ <span class="token operator">=</span> RES<span class="token punctuation">.</span>ID_ and M<span class="token punctuation">.</span>USER_ID_ <span class="token operator">=</span> <span class="token operator">?</span><span class="token operator">)</span> order by RES<span class="token punctuation">.</span>ID_ asc
<span class="token operator">=</span><span class="token operator">=</span><span class="token operator">&gt;</span> Parameters<span class="token operator">:</span> ysmc<span class="token operator">(</span>String<span class="token operator">)</span>
<span class="token operator">&lt;</span><span class="token operator">=</span><span class="token operator">=</span>      Total<span class="token operator">:</span> <span class="token number">1</span>
</code></pre></div><h2 id="\u5176\u4ED6\u76F8\u5173-api" tabindex="-1"><a class="header-anchor" href="#\u5176\u4ED6\u76F8\u5173-api" aria-hidden="true">#</a> \u5176\u4ED6\u76F8\u5173 API</h2><div class="language-java ext-java"><pre class="language-java"><code><span class="token annotation punctuation">@Test</span>
<span class="token keyword">void</span> <span class="token function">test12</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token comment">// \u67E5\u8BE2\u7CFB\u7EDF\u4FE1\u606F\uFF0C\u672C\u8D28\u4E0A\u662F\u67E5\u8BE2 act_id_property</span>
    <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> properties <span class="token operator">=</span> idmManagementService<span class="token punctuation">.</span><span class="token function">getProperties</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> strings <span class="token operator">=</span> properties<span class="token punctuation">.</span><span class="token function">keySet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token class-name">String</span> string <span class="token operator">:</span> strings<span class="token punctuation">)</span><span class="token punctuation">{</span>
        logger<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;key:{};value:{}&quot;</span><span class="token punctuation">,</span>string<span class="token punctuation">,</span>properties<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// \u67E5\u8BE2\u5B9E\u4F53\u7C7B\u6240\u5BF9\u5E94\u7684\u8868\u540D\u79F0</span>
    <span class="token class-name">String</span> tableName <span class="token operator">=</span> idmManagementService<span class="token punctuation">.</span><span class="token function">getTableName</span><span class="token punctuation">(</span><span class="token class-name">Group</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    logger<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;tableName:{}&quot;</span><span class="token punctuation">,</span>tableName<span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token comment">// \u83B7\u53D6\u8868\u7684\u8BE6\u7EC6\u4FE1\u606F</span>
    <span class="token class-name">TableMetaData</span> tableMetaData <span class="token operator">=</span> idmManagementService<span class="token punctuation">.</span><span class="token function">getTableMetaData</span><span class="token punctuation">(</span>tableName<span class="token punctuation">)</span><span class="token punctuation">;</span>
    logger<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;\u5217\u660E\uFF1A{}&quot;</span><span class="token punctuation">,</span>tableMetaData<span class="token punctuation">.</span><span class="token function">getColumnNames</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    logger<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;\u5217\u7684\u7C7B\u578B\uFF1A{}&quot;</span><span class="token punctuation">,</span>tableMetaData<span class="token punctuation">.</span><span class="token function">getColumnTypes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div>`,41);function p(o,c){return t}var l=s(a,[["render",p]]);export{l as default};
